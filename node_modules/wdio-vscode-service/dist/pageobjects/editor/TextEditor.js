var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { fileURLToPath } from 'node:url';
import clipboard from 'clipboardy';
import { Key } from 'webdriverio';
import logger from '@wdio/logger';
import { ContentAssist, ContextMenu, InputBox } from '../index.js';
import { StatusBar } from '../statusBar/StatusBar.js';
import { Editor } from './Editor.js';
import { PageDecorator, BasePage, ElementWithContextMenu, semverLt } from '../utils.js';
import { TextEditor as TextEditorLocators, FindWidget as FindWidgetLocators } from '../../locators/1.73.0.js';
import { CMD_KEY } from '../../constants.js';
const log = logger('wdio-vscode-service');
/**
 * Page object representing the active text editor
 *
 * @category Editor
 */
let TextEditor = class TextEditor extends Editor {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = 'TextEditor';
    }
    /**
     * Find whether the active editor has unsaved changes
     * @returns Promise resolving to true/false
     */
    async isDirty() {
        const klass = await this.parent.$(this.locators.activeTab).getAttribute('class');
        return klass.indexOf('dirty') >= 0;
    }
    /**
     * Saves the active editor
     * @returns Promise resolving when ctrl+s is invoked
     */
    async save() {
        await browser.action('key')
            .down(CMD_KEY).down('s')
            .pause(10)
            .up(CMD_KEY).up('s')
            .perform();
    }
    /**
     * Open the Save as prompt
     *
     * @returns InputBox serving as a simple file dialog
     */
    async saveAs() {
        await browser.action('key')
            .down(CMD_KEY).down(Key.Shift).down('s')
            .pause(10)
            .up(CMD_KEY).down(Key.Shift).up('s')
            .perform();
        const inputBox = browser.$(this.locatorMap.InputBox.elem);
        await inputBox.waitForExist({ timeout: 5000 });
        return new InputBox(this.locatorMap, inputBox);
    }
    /**
     * Retrieve the Uri of the file opened in the active editor
     * @returns Promise resolving to editor's underlying Uri
     */
    async getFileUri() {
        const ed = await this.editorContainer$;
        return ed.getAttribute(this.locators.dataUri);
    }
    /**
     * Retrieve the path to the file opened in the active editor
     * @returns Promise resolving to editor's underlying file path
     */
    async getFilePath() {
        return fileURLToPath(await this.getFileUri());
    }
    /**
     * Open/Close the content assistant at the current position in the editor by sending the default
     * keyboard shortcut signal
     * @param open true to open, false to close
     * @returns Promise resolving to ContentAssist object when opening, void otherwise
     */
    async toggleContentAssist(open) {
        let isHidden = true;
        try {
            const assist = await this.elem.$(this.locatorMap.ContentAssist.elem);
            const klass = await assist.getAttribute('class');
            const visibility = await assist.getCSSProperty('visibility');
            isHidden = klass.indexOf('visible') < 0 || visibility.value === 'hidden';
        }
        catch (err) {
            isHidden = true;
        }
        if (open) {
            if (isHidden) {
                await browser.action('key')
                    .down(CMD_KEY).down(Key.Space)
                    .up(CMD_KEY).up(Key.Space)
                    .perform();
                await browser.$(this.locatorMap.ContentAssist.elem)
                    .waitForExist({ timeout: 2000 });
            }
            const assist = await new ContentAssist(this.locatorMap, this).wait();
            await browser.waitUntil(() => assist.isLoaded(), { timeout: 10000 });
            return assist;
        }
        if (!isHidden) {
            await browser.action('key')
                .down(Key.Escape).up(Key.Escape)
                .perform();
        }
        return undefined;
    }
    /**
     * Get all text from the editor
     * @returns Promise resolving to editor text
     */
    async getText() {
        await browser.action('key')
            .down(CMD_KEY).down('a').down('c')
            .pause(10)
            .up(CMD_KEY).up('a').up('c')
            .perform();
        const text = clipboard.readSync();
        await browser.action('key')
            .down(Key.ArrowUp).up(Key.ArrowUp)
            .perform();
        clipboard.writeSync('');
        /**
         * let's return "" if the editor is empty rather than "\n"
         */
        return text.trim().length === 0
            ? ''
            : text;
    }
    /**
     * Replace the contents of the editor with a given text
     * @param text text to type into the editor
     * @param formatText format the new text, default false
     * @returns Promise resolving once the new text is copied over
     */
    async setText(text, formatText = false) {
        clipboard.writeSync(text);
        await browser.action('key')
            .down(CMD_KEY).down('a').down('v')
            .pause(10)
            .up(CMD_KEY).up('a').up('v')
            .perform();
        clipboard.writeSync('');
        if (formatText) {
            await this.formatDocument();
        }
    }
    /**
     * Deletes all text within the editor
     * @returns Promise resolving once the text is deleted
     */
    async clearText() {
        await browser.action('key')
            .down(CMD_KEY).down('a').down(Key.Backspace)
            .pause(10)
            .up(CMD_KEY).up('a').up(Key.Backspace)
            .perform();
    }
    /**
     * Get text from a given line
     * @param line number of the line to retrieve
     * @returns Promise resolving to text at the given line number
     */
    async getTextAtLine(line) {
        const text = await this.getText();
        const lines = text.split('\n');
        if (line < 1 || line > lines.length) {
            throw new Error(`Line number ${line} does not exist`);
        }
        return lines[line - 1].trim();
    }
    /**
     * Replace the contents of a line with a given text
     * @param line number of the line to edit
     * @param text text to set at the line
     * @returns Promise resolving when the text is typed in
     */
    async setTextAtLine(line, text) {
        if (line < 1 || line > await this.getNumberOfLines()) {
            throw new Error(`Line number ${line} does not exist`);
        }
        const lines = (await this.getText()).split('\n');
        lines[line - 1] = text;
        await this.setText(lines.join('\n'));
    }
    /**
     * Get line number that contains the given text. Not suitable for multi line inputs.
     *
     * @param text text to search for
     * @param occurrence select which occurrence of the search text to look for in case
     *                   there are multiple in the document, defaults to 1 (the first instance)
     *
     * @returns Number of the line that contains the start of the given text. -1 if no such text is found.
     * If occurrence number is specified, searches until it finds as many instances of the given text.
     * Returns the line number that holds the last occurrence found this way.
     */
    async getLineOfText(text, occurrence = 1) {
        let lineNum = -1;
        let found = 0;
        const lines = (await this.getText()).split('\n');
        for (let i = 0; i < lines.length; i += 1) {
            if (lines[i].includes(text)) {
                found += 1;
                lineNum = i + 1;
                if (found >= occurrence) {
                    break;
                }
            }
        }
        return lineNum;
    }
    /**
     * Find and select a given text. Not usable for multi line selection.
     *
     * @param text text to select
     * @param occurrence specify which onccurrence of text to select if multiple are present in the document
     */
    async selectText(text, occurrence = 1) {
        const lineNum = await this.getLineOfText(text, occurrence);
        if (lineNum < 1) {
            throw new Error(`Text '${text}' not found`);
        }
        const line = await this.getTextAtLine(lineNum);
        const column = line.indexOf(text) + 1;
        await this.moveCursor(lineNum, column);
        await browser.action('key')
            .down(CMD_KEY).down(Key.Shift).down(Key.ArrowRight)
            .pause(10)
            .up(CMD_KEY).up(Key.Shift).up(Key.ArrowRight)
            .perform();
    }
    /**
     * Get the text that is currently selected as string
     */
    async getSelectedText() {
        await browser.action('key')
            .down(CMD_KEY).down('c')
            .up(CMD_KEY).up('c')
            .perform();
        return clipboard.read();
    }
    /**
     * Get the selection block as a page object
     * @returns Selection page object
     */
    async getSelection() {
        const selection = await this.selection$$;
        if (selection.length < 1) {
            return undefined;
        }
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        return new Selection(this.locatorMap, selection[0], this);
    }
    async openFindWidget() {
        await browser.keys([CMD_KEY, 'f']);
        const widget = await browser.$(this.locators.findWidget);
        await widget.waitForDisplayed({ timeout: 2000 });
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        return new FindWidget(this.locatorMap, widget, this);
    }
    /**
     * Add the given text to the given coordinates
     * @param line number of the line to type into
     * @param column number of the column to start typing at
     * @param text text to add
     * @returns Promise resolving when the text is typed in
     */
    async typeTextAt(line, column, text) {
        await this.moveCursor(line, column);
        const inputarea = await this.elem.$(this.locatorMap.Editor.inputArea);
        await inputarea.addValue(text);
    }
    /**
     * Type given text at the current coordinates
     * @param text text to type
     * @returns promise resolving when the text is typed in
     */
    async typeText(text) {
        const inputarea = await this.elem.$(this.locatorMap.Editor.inputArea);
        await inputarea.addValue(text);
    }
    /**
     * Move the cursor to the given coordinates
     * @param line line number to move to
     * @param column column number to move to
     * @returns Promise resolving when the cursor has reached the given coordinates
     */
    async moveCursor(line, column) {
        if (line < 1 || line > await this.getNumberOfLines()) {
            throw new Error(`Line number ${line} does not exist`);
        }
        if (column < 1) {
            throw new Error(`Column number ${column} does not exist`);
        }
        let coordinates = await this.getCoordinates();
        const lineGap = coordinates[0] - line;
        const lineKey = lineGap >= 0 ? Key.ArrowUp : Key.ArrowDown;
        for (let i = 0; i < Math.abs(lineGap); i += 1) {
            await browser.action('key')
                .down(lineKey).pause(10).up(lineKey)
                .perform();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(50);
        }
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(100);
        coordinates = await this.getCoordinates();
        const columnGap = coordinates[1] - column;
        const columnKey = columnGap >= 0 ? Key.ArrowLeft : Key.ArrowRight;
        for (let i = 0; i < Math.abs(columnGap); i += 1) {
            await browser.action('key')
                .down(columnKey).pause(10).up(columnKey)
                .perform();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(50);
            if ((await this.getCoordinates())[0] !== coordinates[0]) {
                throw new Error(`Column number ${column} is not accessible on line ${line}`);
            }
        }
    }
    /**
     * Get number of lines in the editor
     * @returns Promise resolving to number of lines
     */
    async getNumberOfLines() {
        const lines = (await this.getText()).split('\n');
        return lines.length;
    }
    /**
     * Use the built-in 'Format Document' option to format the text
     * @returns Promise resolving when the Format Document command is invoked
     */
    async formatDocument() {
        const menu = await this.openContextMenu();
        try {
            await menu.select('Format Document');
        }
        catch (err) {
            log.error('Warn: Format Document not available for selected language');
            if (await menu.elem.isDisplayed()) {
                await menu.close();
            }
        }
    }
    async openContextMenu() {
        await this.elem.click({ button: 2 });
        const shadowRootHost = await this.view.elem.$$('.shadow-root-host');
        if (shadowRootHost.length > 0) {
            const shadowRoot = $(await browser.execute('return arguments[0].shadowRoot', shadowRootHost[0]));
            return new ContextMenu(this.locatorMap, shadowRoot).wait();
        }
        return super.openContextMenu();
    }
    /**
     * Get the cursor's coordinates as an array of two numbers: `[line, column]`
     *
     * **Caution** line & column coordinates do not start at `0` but at `1`!
     */
    async getCoordinates() {
        const coords = [];
        const statusBar = new StatusBar(this.locatorMap);
        const coordinates = (await statusBar.getCurrentPosition()).match(/\d+/g);
        for (const c of coordinates) {
            coords.push(+c);
        }
        return [coords[0], coords[1]];
    }
    /**
     * Toggle breakpoint on a given line
     *
     * @param line target line number
     * @returns promise resolving to true when a breakpoint was added, false when removed or
     */
    async toggleBreakpoint(line) {
        const margin = await this.marginArea$;
        const lineNum = await margin.$(this.locators.lineNumber(line));
        await lineNum.moveTo();
        const lineOverlay = await margin.$(this.locators.lineOverlay(line));
        const breakPoint = await lineOverlay.$$(this.locators.breakPoint);
        if (breakPoint.length > 0) {
            await breakPoint[0].click();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(200);
            return false;
        }
        const noBreak = await lineOverlay.$$(this.locators.debugHint);
        if (noBreak.length > 0) {
            await noBreak[0].click();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(200);
            return true;
        }
        return false;
    }
    /**
     * Get all code lenses within the editor
     * @returns list of CodeLens page objects
     */
    async getCodeLenses() {
        const lenses = [];
        const widgets = await this.elem.$('.contentWidgets');
        const items = await widgets.$$('.//span[contains(@widgetid, \'codelens.widget\')]');
        for (const item of items) {
            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
            lenses.push(await new CodeLens(this.locatorMap, item, this).wait());
        }
        return lenses;
    }
    /**
     * Get a code lens based on title, or zero based index
     *
     * @param indexOrTitle zero based index (counting from the top of the editor), or partial title of the code lens
     * @returns CodeLens object if such a code lens exists, undefined otherwise
     */
    async getCodeLens(indexOrTitle) {
        const lenses = await this.getCodeLenses();
        if (typeof indexOrTitle === 'string') {
            for (const lens of lenses) {
                const title = await lens.getText();
                const match = title.match(indexOrTitle);
                if (match && match.length > 0) {
                    return lens;
                }
            }
        }
        else if (lenses[indexOrTitle]) {
            return lenses[indexOrTitle];
        }
        return undefined;
    }
};
TextEditor = __decorate([
    PageDecorator(TextEditorLocators)
], TextEditor);
export { TextEditor };
/**
 * Text selection block
 *
 * @category Editor
 */
let Selection = class Selection extends ElementWithContextMenu {
    constructor(locators, element, editor) {
        super(locators, element);
        this.editor = editor;
        /**
         * @private
         */
        this.locatorKey = 'TextEditor';
    }
    async openContextMenu() {
        await this.elem.click({ button: 2 });
        const shadowRootHost = await this.editor.view.elem.$$('.shadow-root-host');
        if (shadowRootHost.length > 0) {
            const shadowRoot = $(await browser.execute('return arguments[0].shadowRoot', shadowRootHost[0]));
            return new ContextMenu(this.locatorMap, shadowRoot).wait();
        }
        return super.openContextMenu();
    }
};
Selection = __decorate([
    PageDecorator(TextEditorLocators)
], Selection);
/**
 * Page object for Code Lens inside a text editor
 *
 * @category Editor
 */
let CodeLens = class CodeLens extends BasePage {
    constructor(locators, element, editor) {
        super(locators, element);
        this.editor = editor;
        /**
         * @private
         */
        this.locatorKey = 'TextEditor';
    }
    /**
     * Get the text displayed on the code lens
     * @returns text as string
     */
    async getText() {
        const link = await this.elem.$('a');
        return link.getText();
    }
    /**
     * Get tooltip of the code lens
     * @returns tooltip as string
     */
    async getTooltip() {
        const link = await this.elem.$('a');
        return link.getAttribute('title');
    }
};
CodeLens = __decorate([
    PageDecorator(TextEditorLocators)
], CodeLens);
export { CodeLens };
/**
 * Text Editor's Find Widget
 *
 * @category Editor
 */
let FindWidget = class FindWidget extends BasePage {
    constructor(locators, element, textEditor) {
        super(locators, element);
        this.textEditor = textEditor;
        /**
         * @private
         */
        this.locatorKey = 'FindWidget';
    }
    /**
     * Toggle between find and replace mode
     * @param replace true for replace, false for find
     */
    async toggleReplace(replace) {
        const btn = await this.toggleReplace$;
        const klass = await btn.getAttribute('class');
        if ((replace && klass.includes('collapsed')) || (!replace && !klass.includes('collapsed'))) {
            await btn.addValue(' ');
            const repl = await browser.$(this.locators.replacePart);
            await repl.waitForExist({ timeout: 2000 });
            if (replace) {
                await repl.waitForDisplayed({ timeout: 2000 });
            }
            else {
                await repl.waitForDisplayed({ timeout: 2000, reverse: true });
            }
        }
    }
    /**
     * Set text in the search box
     * @param text text to fill in
     */
    async setSearchText(text) {
        await browser.keys([CMD_KEY, 'f']);
        await browser.keys(text);
    }
    /**
     * Get text from Find input box
     * @returns value of find input as string
     */
    async getSearchText() {
        const findPart = await this.findPart$;
        return this.getInputText(findPart);
    }
    /**
     * Set text in the replace box. Will toggle replace mode on if called in find mode.
     * @param text text to fill in
     */
    async setReplaceText(text) {
        await this.toggleReplace(true);
        const replacePart = await this.replacePart$;
        await this.setText(text, replacePart);
    }
    /**
     * Get text from Replace input box
     * @returns value of replace input as string
     */
    async getReplaceText() {
        const replacePart = await this.replacePart$;
        return this.getInputText(replacePart);
    }
    /**
     * Click 'Next match'
     */
    async nextMatch() {
        const version = await browser.getVSCodeVersion();
        const name = semverLt(version, '1.59.0') ? 'Next match' : 'Next Match';
        await this.clickButton(name, 'find');
    }
    /**
     * Click 'Previous match'
     */
    async previousMatch() {
        const version = await browser.getVSCodeVersion();
        const name = semverLt(version, '1.59.0')
            ? 'Previous match'
            : 'Previous Match';
        await this.clickButton(name, 'find');
    }
    /**
     * Click 'Replace'. Only works in replace mode.
     */
    async replace() {
        await this.clickButton('Replace', 'replace');
    }
    /**
     * Click 'Replace All'. Only works in replace mode.
     */
    async replaceAll() {
        await this.clickButton('Replace All', 'replace');
    }
    /**
     * Close the widget.
     */
    async close() {
        await this.clickButton('Close', 'find');
    }
    /**
     * Get the number of results as an ordered pair of numbers
     * @returns pair in form of [current result index, total number of results]
     */
    async getResultCount() {
        const count = await this.matchCount$;
        const text = await count.getText();
        if (text.includes('No results')) {
            return [0, 0];
        }
        const numbers = text.split(' of ');
        return [+numbers[0], +numbers[1]];
    }
    /**
     * Toggle the search to match case
     * @param toggle true to turn on, false to turn off
     */
    async toggleMatchCase(toggle) {
        await this.toggleControl('Match Case', 'find', toggle);
    }
    /**
     * Toggle the search to match whole words
     * @param toggle true to turn on, false to turn off
     */
    async toggleMatchWholeWord(toggle) {
        await this.toggleControl('Match Whole Word', 'find', toggle);
    }
    /**
     * Toggle the search to use regular expressions
     * @param toggle true to turn on, false to turn off
     */
    async toggleUseRegularExpression(toggle) {
        await this.toggleControl('Use Regular Expression', 'find', toggle);
    }
    /**
     * Toggle the replace to preserve case
     * @param toggle true to turn on, false to turn off
     */
    async togglePreserveCase(toggle) {
        await this.toggleControl('Preserve Case', 'replace', toggle);
    }
    async toggleControl(title, part, toggle) {
        if (part !== 'find' && part !== 'replace') {
            throw new Error('"part" parameter needs to be "find" or "replace"');
        }
        const element = part === 'find'
            ? await this.findPart$
            : await this.replacePart$;
        if (part === 'replace') {
            await this.toggleReplace(true);
        }
        const control = await element.$(this.locators.checkbox(title));
        const checked = await control.getAttribute('aria-checked');
        if ((toggle && checked !== 'true') || (!toggle && checked === 'true')) {
            await control.click();
        }
    }
    async clickButton(title, part) {
        if (part !== 'find' && part !== 'replace') {
            throw new Error('"part" parameter needs to be "find" or "replace"');
        }
        const element = part === 'find'
            ? await this.findPart$
            : await this.replacePart$;
        if (part === 'replace') {
            await this.toggleReplace(true);
        }
        const btn = await element.$(this.locators.button(title));
        await btn.click();
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(100);
    }
    async setText(text, composite) {
        const input = await composite.$(this.locators.input);
        await input.setValue(text);
    }
    async getInputText(composite) {
        const input = await composite.$(this.locators.content);
        return input.getHTML(false);
    }
};
FindWidget = __decorate([
    PageDecorator(FindWidgetLocators)
], FindWidget);
export { FindWidget };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV4dEVkaXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wYWdlb2JqZWN0cy9lZGl0b3IvVGV4dEVkaXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ3hDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsR0FBRyxFQUEyQixNQUFNLGFBQWEsQ0FBQTtBQUUxRCxPQUFPLE1BQU0sTUFBTSxjQUFjLENBQUE7QUFDakMsT0FBTyxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBQ2xFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFrQixNQUFNLGFBQWEsQ0FBQTtBQUNwRCxPQUFPLEVBQ0gsYUFBYSxFQUFrQixRQUFRLEVBQUUsc0JBQXNCLEVBQW9CLFFBQVEsRUFDOUYsTUFBTSxhQUFhLENBQUE7QUFDcEIsT0FBTyxFQUNILFVBQVUsSUFBSSxrQkFBa0IsRUFDaEMsVUFBVSxJQUFJLGtCQUFrQixFQUNuQyxNQUFNLDBCQUEwQixDQUFBO0FBQ2pDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUU1QyxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQTtBQUd6Qzs7OztHQUlHO0FBRUksSUFBTSxVQUFVLEdBQWhCLE1BQU0sVUFBVyxTQUFRLE1BQXNCO0lBQS9DOztRQUNIOztXQUVHO1FBQ0ksZUFBVSxHQUFHLFlBQXFCLENBQUE7SUE2YjdDLENBQUM7SUEzYkc7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLE9BQU87UUFDVCxNQUFNLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FB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S0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUMvQixDQUFDO0NBQ0osQ0FBQTtBQS9NWSxVQUFVO0lBRHRCLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztHQUNyQixVQUFVLENBK010QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZpbGVVUkxUb1BhdGggfSBmcm9tICdub2RlOnVybCdcbmltcG9ydCBjbGlwYm9hcmQgZnJvbSAnY2xpcGJvYXJkeSdcbmltcG9ydCB7IEtleSwgQ2hhaW5hYmxlUHJvbWlzZUVsZW1lbnQgfSBmcm9tICd3ZWJkcml2ZXJpbydcblxuaW1wb3J0IGxvZ2dlciBmcm9tICdAd2Rpby9sb2dnZXInXG5pbXBvcnQgeyBDb250ZW50QXNzaXN0LCBDb250ZXh0TWVudSwgSW5wdXRCb3ggfSBmcm9tICcuLi9pbmRleC5qcydcbmltcG9ydCB7IFN0YXR1c0JhciB9IGZyb20gJy4uL3N0YXR1c0Jhci9TdGF0dXNCYXIuanMnXG5pbXBvcnQgeyBFZGl0b3IsIEVkaXRvckxvY2F0b3JzIH0gZnJvbSAnLi9FZGl0b3IuanMnXG5pbXBvcnQge1xuICAgIFBhZ2VEZWNvcmF0b3IsIElQYWdlRGVjb3JhdG9yLCBCYXNlUGFnZSwgRWxlbWVudFdpdGhDb250ZXh0TWVudSwgVlNDb2RlTG9jYXRvck1hcCwgc2VtdmVyTHRcbn0gZnJvbSAnLi4vdXRpbHMuanMnXG5pbXBvcnQge1xuICAgIFRleHRFZGl0b3IgYXMgVGV4dEVkaXRvckxvY2F0b3JzLFxuICAgIEZpbmRXaWRnZXQgYXMgRmluZFdpZGdldExvY2F0b3JzXG59IGZyb20gJy4uLy4uL2xvY2F0b3JzLzEuNzMuMC5qcydcbmltcG9ydCB7IENNRF9LRVkgfSBmcm9tICcuLi8uLi9jb25zdGFudHMuanMnXG5cbmNvbnN0IGxvZyA9IGxvZ2dlcignd2Rpby12c2NvZGUtc2VydmljZScpXG5cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dEVkaXRvciBleHRlbmRzIElQYWdlRGVjb3JhdG9yPEVkaXRvckxvY2F0b3JzPiB7fVxuLyoqXG4gKiBQYWdlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGFjdGl2ZSB0ZXh0IGVkaXRvclxuICpcbiAqIEBjYXRlZ29yeSBFZGl0b3JcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoVGV4dEVkaXRvckxvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIFRleHRFZGl0b3IgZXh0ZW5kcyBFZGl0b3I8RWRpdG9yTG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ1RleHRFZGl0b3InIGFzIGNvbnN0XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHdoZXRoZXIgdGhlIGFjdGl2ZSBlZGl0b3IgaGFzIHVuc2F2ZWQgY2hhbmdlc1xuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRydWUvZmFsc2VcbiAgICAgKi9cbiAgICBhc3luYyBpc0RpcnR5ICgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgY29uc3Qga2xhc3MgPSBhd2FpdCB0aGlzLnBhcmVudC4kKHRoaXMubG9jYXRvcnMuYWN0aXZlVGFiKS5nZXRBdHRyaWJ1dGUoJ2NsYXNzJylcbiAgICAgICAgcmV0dXJuIGtsYXNzLmluZGV4T2YoJ2RpcnR5JykgPj0gMFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhdmVzIHRoZSBhY3RpdmUgZWRpdG9yXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiBjdHJsK3MgaXMgaW52b2tlZFxuICAgICAqL1xuICAgIGFzeW5jIHNhdmUgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JylcbiAgICAgICAgICAgIC5kb3duKENNRF9LRVkpLmRvd24oJ3MnKVxuICAgICAgICAgICAgLnBhdXNlKDEwKVxuICAgICAgICAgICAgLnVwKENNRF9LRVkpLnVwKCdzJylcbiAgICAgICAgICAgIC5wZXJmb3JtKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoZSBTYXZlIGFzIHByb21wdFxuICAgICAqXG4gICAgICogQHJldHVybnMgSW5wdXRCb3ggc2VydmluZyBhcyBhIHNpbXBsZSBmaWxlIGRpYWxvZ1xuICAgICAqL1xuICAgIGFzeW5jIHNhdmVBcyAoKTogUHJvbWlzZTxJbnB1dEJveD4ge1xuICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JylcbiAgICAgICAgICAgIC5kb3duKENNRF9LRVkpLmRvd24oS2V5LlNoaWZ0KS5kb3duKCdzJylcbiAgICAgICAgICAgIC5wYXVzZSgxMClcbiAgICAgICAgICAgIC51cChDTURfS0VZKS5kb3duKEtleS5TaGlmdCkudXAoJ3MnKVxuICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICBjb25zdCBpbnB1dEJveCA9IGJyb3dzZXIuJCh0aGlzLmxvY2F0b3JNYXAuSW5wdXRCb3guZWxlbSBhcyBzdHJpbmcpXG4gICAgICAgIGF3YWl0IGlucHV0Qm94LndhaXRGb3JFeGlzdCh7IHRpbWVvdXQ6IDUwMDAgfSlcbiAgICAgICAgcmV0dXJuIG5ldyBJbnB1dEJveCh0aGlzLmxvY2F0b3JNYXAsIGlucHV0Qm94KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIHRoZSBVcmkgb2YgdGhlIGZpbGUgb3BlbmVkIGluIHRoZSBhY3RpdmUgZWRpdG9yXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gZWRpdG9yJ3MgdW5kZXJseWluZyBVcmlcbiAgICAgKi9cbiAgICBhc3luYyBnZXRGaWxlVXJpICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCBlZCA9IGF3YWl0IHRoaXMuZWRpdG9yQ29udGFpbmVyJFxuICAgICAgICByZXR1cm4gZWQuZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMuZGF0YVVyaSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSB0aGUgcGF0aCB0byB0aGUgZmlsZSBvcGVuZWQgaW4gdGhlIGFjdGl2ZSBlZGl0b3JcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBlZGl0b3IncyB1bmRlcmx5aW5nIGZpbGUgcGF0aFxuICAgICAqL1xuICAgIGFzeW5jIGdldEZpbGVQYXRoICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gZmlsZVVSTFRvUGF0aChhd2FpdCB0aGlzLmdldEZpbGVVcmkoKSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuL0Nsb3NlIHRoZSBjb250ZW50IGFzc2lzdGFudCBhdCB0aGUgY3VycmVudCBwb3NpdGlvbiBpbiB0aGUgZWRpdG9yIGJ5IHNlbmRpbmcgdGhlIGRlZmF1bHRcbiAgICAgKiBrZXlib2FyZCBzaG9ydGN1dCBzaWduYWxcbiAgICAgKiBAcGFyYW0gb3BlbiB0cnVlIHRvIG9wZW4sIGZhbHNlIHRvIGNsb3NlXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gQ29udGVudEFzc2lzdCBvYmplY3Qgd2hlbiBvcGVuaW5nLCB2b2lkIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGFzeW5jIHRvZ2dsZUNvbnRlbnRBc3Npc3QgKG9wZW46IGJvb2xlYW4pOiBQcm9taXNlPENvbnRlbnRBc3Npc3QgfCB1bmRlZmluZWQ+IHtcbiAgICAgICAgbGV0IGlzSGlkZGVuID0gdHJ1ZVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYXNzaXN0ID0gYXdhaXQgdGhpcy5lbGVtLiQodGhpcy5sb2NhdG9yTWFwLkNvbnRlbnRBc3Npc3QuZWxlbSBhcyBzdHJpbmcpXG4gICAgICAgICAgICBjb25zdCBrbGFzcyA9IGF3YWl0IGFzc2lzdC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJylcbiAgICAgICAgICAgIGNvbnN0IHZpc2liaWxpdHkgPSBhd2FpdCBhc3Npc3QuZ2V0Q1NTUHJvcGVydHkoJ3Zpc2liaWxpdHknKVxuICAgICAgICAgICAgaXNIaWRkZW4gPSBrbGFzcy5pbmRleE9mKCd2aXNpYmxlJykgPCAwIHx8IHZpc2liaWxpdHkudmFsdWUgPT09ICdoaWRkZW4nXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgaXNIaWRkZW4gPSB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wZW4pIHtcbiAgICAgICAgICAgIGlmIChpc0hpZGRlbikge1xuICAgICAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgICAgICAgICAuZG93bihDTURfS0VZKS5kb3duKEtleS5TcGFjZSlcbiAgICAgICAgICAgICAgICAgICAgLnVwKENNRF9LRVkpLnVwKEtleS5TcGFjZSlcbiAgICAgICAgICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIuJCh0aGlzLmxvY2F0b3JNYXAuQ29udGVudEFzc2lzdC5lbGVtIGFzIHN0cmluZylcbiAgICAgICAgICAgICAgICAgICAgLndhaXRGb3JFeGlzdCh7IHRpbWVvdXQ6IDIwMDAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGFzc2lzdCA9IGF3YWl0IG5ldyBDb250ZW50QXNzaXN0KHRoaXMubG9jYXRvck1hcCwgdGhpcykud2FpdCgpXG4gICAgICAgICAgICBhd2FpdCBicm93c2VyLndhaXRVbnRpbCgoKSA9PiBhc3Npc3QuaXNMb2FkZWQoKSwgeyB0aW1lb3V0OiAxMDAwMCB9KVxuICAgICAgICAgICAgcmV0dXJuIGFzc2lzdFxuICAgICAgICB9XG4gICAgICAgIGlmICghaXNIaWRkZW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgICAgIC5kb3duKEtleS5Fc2NhcGUpLnVwKEtleS5Fc2NhcGUpXG4gICAgICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRleHQgZnJvbSB0aGUgZWRpdG9yXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gZWRpdG9yIHRleHRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRUZXh0ICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JylcbiAgICAgICAgICAgIC5kb3duKENNRF9LRVkpLmRvd24oJ2EnKS5kb3duKCdjJylcbiAgICAgICAgICAgIC5wYXVzZSgxMClcbiAgICAgICAgICAgIC51cChDTURfS0VZKS51cCgnYScpLnVwKCdjJylcbiAgICAgICAgICAgIC5wZXJmb3JtKClcbiAgICAgICAgY29uc3QgdGV4dCA9IGNsaXBib2FyZC5yZWFkU3luYygpXG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgLmRvd24oS2V5LkFycm93VXApLnVwKEtleS5BcnJvd1VwKVxuICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICBjbGlwYm9hcmQud3JpdGVTeW5jKCcnKVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBsZXQncyByZXR1cm4gXCJcIiBpZiB0aGUgZWRpdG9yIGlzIGVtcHR5IHJhdGhlciB0aGFuIFwiXFxuXCJcbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiB0ZXh0LnRyaW0oKS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgID8gJydcbiAgICAgICAgICAgIDogdGV4dFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcGxhY2UgdGhlIGNvbnRlbnRzIG9mIHRoZSBlZGl0b3Igd2l0aCBhIGdpdmVuIHRleHRcbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIHR5cGUgaW50byB0aGUgZWRpdG9yXG4gICAgICogQHBhcmFtIGZvcm1hdFRleHQgZm9ybWF0IHRoZSBuZXcgdGV4dCwgZGVmYXVsdCBmYWxzZVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIG9uY2UgdGhlIG5ldyB0ZXh0IGlzIGNvcGllZCBvdmVyXG4gICAgICovXG4gICAgYXN5bmMgc2V0VGV4dCAodGV4dDogc3RyaW5nLCBmb3JtYXRUZXh0ID0gZmFsc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY2xpcGJvYXJkLndyaXRlU3luYyh0ZXh0KVxuICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JylcbiAgICAgICAgICAgIC5kb3duKENNRF9LRVkpLmRvd24oJ2EnKS5kb3duKCd2JylcbiAgICAgICAgICAgIC5wYXVzZSgxMClcbiAgICAgICAgICAgIC51cChDTURfS0VZKS51cCgnYScpLnVwKCd2JylcbiAgICAgICAgICAgIC5wZXJmb3JtKClcbiAgICAgICAgY2xpcGJvYXJkLndyaXRlU3luYygnJylcbiAgICAgICAgaWYgKGZvcm1hdFRleHQpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZm9ybWF0RG9jdW1lbnQoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlcyBhbGwgdGV4dCB3aXRoaW4gdGhlIGVkaXRvclxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIG9uY2UgdGhlIHRleHQgaXMgZGVsZXRlZFxuICAgICAqL1xuICAgIGFzeW5jIGNsZWFyVGV4dCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgLmRvd24oQ01EX0tFWSkuZG93bignYScpLmRvd24oS2V5LkJhY2tzcGFjZSlcbiAgICAgICAgICAgIC5wYXVzZSgxMClcbiAgICAgICAgICAgIC51cChDTURfS0VZKS51cCgnYScpLnVwKEtleS5CYWNrc3BhY2UpXG4gICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRleHQgZnJvbSBhIGdpdmVuIGxpbmVcbiAgICAgKiBAcGFyYW0gbGluZSBudW1iZXIgb2YgdGhlIGxpbmUgdG8gcmV0cmlldmVcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byB0ZXh0IGF0IHRoZSBnaXZlbiBsaW5lIG51bWJlclxuICAgICAqL1xuICAgIGFzeW5jIGdldFRleHRBdExpbmUgKGxpbmU6IG51bWJlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0aGlzLmdldFRleHQoKVxuICAgICAgICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoJ1xcbicpXG4gICAgICAgIGlmIChsaW5lIDwgMSB8fCBsaW5lID4gbGluZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExpbmUgbnVtYmVyICR7bGluZX0gZG9lcyBub3QgZXhpc3RgKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW5lc1tsaW5lIC0gMV0udHJpbSgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVwbGFjZSB0aGUgY29udGVudHMgb2YgYSBsaW5lIHdpdGggYSBnaXZlbiB0ZXh0XG4gICAgICogQHBhcmFtIGxpbmUgbnVtYmVyIG9mIHRoZSBsaW5lIHRvIGVkaXRcbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIHNldCBhdCB0aGUgbGluZVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIHRleHQgaXMgdHlwZWQgaW5cbiAgICAgKi9cbiAgICBhc3luYyBzZXRUZXh0QXRMaW5lIChsaW5lOiBudW1iZXIsIHRleHQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAobGluZSA8IDEgfHwgbGluZSA+IGF3YWl0IHRoaXMuZ2V0TnVtYmVyT2ZMaW5lcygpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExpbmUgbnVtYmVyICR7bGluZX0gZG9lcyBub3QgZXhpc3RgKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxpbmVzID0gKGF3YWl0IHRoaXMuZ2V0VGV4dCgpKS5zcGxpdCgnXFxuJylcbiAgICAgICAgbGluZXNbbGluZSAtIDFdID0gdGV4dFxuICAgICAgICBhd2FpdCB0aGlzLnNldFRleHQobGluZXMuam9pbignXFxuJykpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGxpbmUgbnVtYmVyIHRoYXQgY29udGFpbnMgdGhlIGdpdmVuIHRleHQuIE5vdCBzdWl0YWJsZSBmb3IgbXVsdGkgbGluZSBpbnB1dHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIHNlYXJjaCBmb3JcbiAgICAgKiBAcGFyYW0gb2NjdXJyZW5jZSBzZWxlY3Qgd2hpY2ggb2NjdXJyZW5jZSBvZiB0aGUgc2VhcmNoIHRleHQgdG8gbG9vayBmb3IgaW4gY2FzZVxuICAgICAqICAgICAgICAgICAgICAgICAgIHRoZXJlIGFyZSBtdWx0aXBsZSBpbiB0aGUgZG9jdW1lbnQsIGRlZmF1bHRzIHRvIDEgKHRoZSBmaXJzdCBpbnN0YW5jZSlcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIE51bWJlciBvZiB0aGUgbGluZSB0aGF0IGNvbnRhaW5zIHRoZSBzdGFydCBvZiB0aGUgZ2l2ZW4gdGV4dC4gLTEgaWYgbm8gc3VjaCB0ZXh0IGlzIGZvdW5kLlxuICAgICAqIElmIG9jY3VycmVuY2UgbnVtYmVyIGlzIHNwZWNpZmllZCwgc2VhcmNoZXMgdW50aWwgaXQgZmluZHMgYXMgbWFueSBpbnN0YW5jZXMgb2YgdGhlIGdpdmVuIHRleHQuXG4gICAgICogUmV0dXJucyB0aGUgbGluZSBudW1iZXIgdGhhdCBob2xkcyB0aGUgbGFzdCBvY2N1cnJlbmNlIGZvdW5kIHRoaXMgd2F5LlxuICAgICAqL1xuICAgIGFzeW5jIGdldExpbmVPZlRleHQgKHRleHQ6IHN0cmluZywgb2NjdXJyZW5jZSA9IDEpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgICBsZXQgbGluZU51bSA9IC0xXG4gICAgICAgIGxldCBmb3VuZCA9IDBcbiAgICAgICAgY29uc3QgbGluZXMgPSAoYXdhaXQgdGhpcy5nZXRUZXh0KCkpLnNwbGl0KCdcXG4nKVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGlmIChsaW5lc1tpXS5pbmNsdWRlcyh0ZXh0KSkge1xuICAgICAgICAgICAgICAgIGZvdW5kICs9IDFcbiAgICAgICAgICAgICAgICBsaW5lTnVtID0gaSArIDFcbiAgICAgICAgICAgICAgICBpZiAoZm91bmQgPj0gb2NjdXJyZW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZU51bVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYW5kIHNlbGVjdCBhIGdpdmVuIHRleHQuIE5vdCB1c2FibGUgZm9yIG11bHRpIGxpbmUgc2VsZWN0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRleHQgdGV4dCB0byBzZWxlY3RcbiAgICAgKiBAcGFyYW0gb2NjdXJyZW5jZSBzcGVjaWZ5IHdoaWNoIG9uY2N1cnJlbmNlIG9mIHRleHQgdG8gc2VsZWN0IGlmIG11bHRpcGxlIGFyZSBwcmVzZW50IGluIHRoZSBkb2N1bWVudFxuICAgICAqL1xuICAgIGFzeW5jIHNlbGVjdFRleHQgKHRleHQ6IHN0cmluZywgb2NjdXJyZW5jZSA9IDEpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgbGluZU51bSA9IGF3YWl0IHRoaXMuZ2V0TGluZU9mVGV4dCh0ZXh0LCBvY2N1cnJlbmNlKVxuICAgICAgICBpZiAobGluZU51bSA8IDEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGV4dCAnJHt0ZXh0fScgbm90IGZvdW5kYClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGxpbmUgPSBhd2FpdCB0aGlzLmdldFRleHRBdExpbmUobGluZU51bSlcbiAgICAgICAgY29uc3QgY29sdW1uID0gbGluZS5pbmRleE9mKHRleHQpICsgMVxuXG4gICAgICAgIGF3YWl0IHRoaXMubW92ZUN1cnNvcihsaW5lTnVtLCBjb2x1bW4pXG5cbiAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAuZG93bihDTURfS0VZKS5kb3duKEtleS5TaGlmdCkuZG93bihLZXkuQXJyb3dSaWdodClcbiAgICAgICAgICAgIC5wYXVzZSgxMClcbiAgICAgICAgICAgIC51cChDTURfS0VZKS51cChLZXkuU2hpZnQpLnVwKEtleS5BcnJvd1JpZ2h0KVxuICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGV4dCB0aGF0IGlzIGN1cnJlbnRseSBzZWxlY3RlZCBhcyBzdHJpbmdcbiAgICAgKi9cbiAgICBhc3luYyBnZXRTZWxlY3RlZFRleHQgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgLmRvd24oQ01EX0tFWSkuZG93bignYycpXG4gICAgICAgICAgICAudXAoQ01EX0tFWSkudXAoJ2MnKVxuICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICByZXR1cm4gY2xpcGJvYXJkLnJlYWQoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgc2VsZWN0aW9uIGJsb2NrIGFzIGEgcGFnZSBvYmplY3RcbiAgICAgKiBAcmV0dXJucyBTZWxlY3Rpb24gcGFnZSBvYmplY3RcbiAgICAgKi9cbiAgICBhc3luYyBnZXRTZWxlY3Rpb24gKCk6IFByb21pc2U8U2VsZWN0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGF3YWl0IHRoaXMuc2VsZWN0aW9uJCRcbiAgICAgICAgaWYgKHNlbGVjdGlvbi5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3Rpb24odGhpcy5sb2NhdG9yTWFwLCBzZWxlY3Rpb25bMF0gYXMgYW55LCB0aGlzKVxuICAgIH1cblxuICAgIGFzeW5jIG9wZW5GaW5kV2lkZ2V0ICgpOiBQcm9taXNlPEZpbmRXaWRnZXQ+IHtcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKFtDTURfS0VZLCAnZiddKVxuICAgICAgICBjb25zdCB3aWRnZXQgPSBhd2FpdCBicm93c2VyLiQodGhpcy5sb2NhdG9ycy5maW5kV2lkZ2V0KVxuICAgICAgICBhd2FpdCB3aWRnZXQud2FpdEZvckRpc3BsYXllZCh7IHRpbWVvdXQ6IDIwMDAgfSlcblxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hcmd1bWVudFxuICAgICAgICByZXR1cm4gbmV3IEZpbmRXaWRnZXQodGhpcy5sb2NhdG9yTWFwLCB3aWRnZXQgYXMgYW55LCB0aGlzKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCB0aGUgZ2l2ZW4gdGV4dCB0byB0aGUgZ2l2ZW4gY29vcmRpbmF0ZXNcbiAgICAgKiBAcGFyYW0gbGluZSBudW1iZXIgb2YgdGhlIGxpbmUgdG8gdHlwZSBpbnRvXG4gICAgICogQHBhcmFtIGNvbHVtbiBudW1iZXIgb2YgdGhlIGNvbHVtbiB0byBzdGFydCB0eXBpbmcgYXRcbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIGFkZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIHRleHQgaXMgdHlwZWQgaW5cbiAgICAgKi9cbiAgICBhc3luYyB0eXBlVGV4dEF0IChsaW5lOiBudW1iZXIsIGNvbHVtbjogbnVtYmVyLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5tb3ZlQ3Vyc29yKGxpbmUsIGNvbHVtbilcbiAgICAgICAgY29uc3QgaW5wdXRhcmVhID0gYXdhaXQgdGhpcy5lbGVtLiQodGhpcy5sb2NhdG9yTWFwLkVkaXRvci5pbnB1dEFyZWEgYXMgc3RyaW5nKVxuICAgICAgICBhd2FpdCBpbnB1dGFyZWEuYWRkVmFsdWUodGV4dClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUeXBlIGdpdmVuIHRleHQgYXQgdGhlIGN1cnJlbnQgY29vcmRpbmF0ZXNcbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIHR5cGVcbiAgICAgKiBAcmV0dXJucyBwcm9taXNlIHJlc29sdmluZyB3aGVuIHRoZSB0ZXh0IGlzIHR5cGVkIGluXG4gICAgICovXG4gICAgYXN5bmMgdHlwZVRleHQgKHRleHQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBpbnB1dGFyZWEgPSBhd2FpdCB0aGlzLmVsZW0uJCh0aGlzLmxvY2F0b3JNYXAuRWRpdG9yLmlucHV0QXJlYSBhcyBzdHJpbmcpXG4gICAgICAgIGF3YWl0IGlucHV0YXJlYS5hZGRWYWx1ZSh0ZXh0KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1vdmUgdGhlIGN1cnNvciB0byB0aGUgZ2l2ZW4gY29vcmRpbmF0ZXNcbiAgICAgKiBAcGFyYW0gbGluZSBsaW5lIG51bWJlciB0byBtb3ZlIHRvXG4gICAgICogQHBhcmFtIGNvbHVtbiBjb2x1bW4gbnVtYmVyIHRvIG1vdmUgdG9cbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIHRoZSBjdXJzb3IgaGFzIHJlYWNoZWQgdGhlIGdpdmVuIGNvb3JkaW5hdGVzXG4gICAgICovXG4gICAgYXN5bmMgbW92ZUN1cnNvciAobGluZTogbnVtYmVyLCBjb2x1bW46IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAobGluZSA8IDEgfHwgbGluZSA+IGF3YWl0IHRoaXMuZ2V0TnVtYmVyT2ZMaW5lcygpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExpbmUgbnVtYmVyICR7bGluZX0gZG9lcyBub3QgZXhpc3RgKVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb2x1bW4gPCAxKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbHVtbiBudW1iZXIgJHtjb2x1bW59IGRvZXMgbm90IGV4aXN0YClcbiAgICAgICAgfVxuICAgICAgICBsZXQgY29vcmRpbmF0ZXMgPSBhd2FpdCB0aGlzLmdldENvb3JkaW5hdGVzKClcbiAgICAgICAgY29uc3QgbGluZUdhcCA9IGNvb3JkaW5hdGVzWzBdIC0gbGluZVxuICAgICAgICBjb25zdCBsaW5lS2V5ID0gbGluZUdhcCA+PSAwID8gS2V5LkFycm93VXAgOiBLZXkuQXJyb3dEb3duXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5hYnMobGluZUdhcCk7IGkgKz0gMSkge1xuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAgICAgLmRvd24obGluZUtleSkucGF1c2UoMTApLnVwKGxpbmVLZXkpXG4gICAgICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHdkaW8vbm8tcGF1c2VcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoNTApXG4gICAgICAgIH1cblxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgd2Rpby9uby1wYXVzZVxuICAgICAgICBhd2FpdCBicm93c2VyLnBhdXNlKDEwMClcbiAgICAgICAgY29vcmRpbmF0ZXMgPSBhd2FpdCB0aGlzLmdldENvb3JkaW5hdGVzKClcbiAgICAgICAgY29uc3QgY29sdW1uR2FwID0gY29vcmRpbmF0ZXNbMV0gLSBjb2x1bW5cbiAgICAgICAgY29uc3QgY29sdW1uS2V5ID0gY29sdW1uR2FwID49IDAgPyBLZXkuQXJyb3dMZWZ0IDogS2V5LkFycm93UmlnaHRcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLmFicyhjb2x1bW5HYXApOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgICAgIC5kb3duKGNvbHVtbktleSkucGF1c2UoMTApLnVwKGNvbHVtbktleSlcbiAgICAgICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgd2Rpby9uby1wYXVzZVxuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5wYXVzZSg1MClcbiAgICAgICAgICAgIGlmICgoYXdhaXQgdGhpcy5nZXRDb29yZGluYXRlcygpKVswXSAhPT0gY29vcmRpbmF0ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbHVtbiBudW1iZXIgJHtjb2x1bW59IGlzIG5vdCBhY2Nlc3NpYmxlIG9uIGxpbmUgJHtsaW5lfWApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgbnVtYmVyIG9mIGxpbmVzIGluIHRoZSBlZGl0b3JcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBudW1iZXIgb2YgbGluZXNcbiAgICAgKi9cbiAgICBhc3luYyBnZXROdW1iZXJPZkxpbmVzICgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgICBjb25zdCBsaW5lcyA9IChhd2FpdCB0aGlzLmdldFRleHQoKSkuc3BsaXQoJ1xcbicpXG4gICAgICAgIHJldHVybiBsaW5lcy5sZW5ndGhcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2UgdGhlIGJ1aWx0LWluICdGb3JtYXQgRG9jdW1lbnQnIG9wdGlvbiB0byBmb3JtYXQgdGhlIHRleHRcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIHRoZSBGb3JtYXQgRG9jdW1lbnQgY29tbWFuZCBpcyBpbnZva2VkXG4gICAgICovXG4gICAgYXN5bmMgZm9ybWF0RG9jdW1lbnQgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBtZW51ID0gYXdhaXQgdGhpcy5vcGVuQ29udGV4dE1lbnUoKVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgbWVudS5zZWxlY3QoJ0Zvcm1hdCBEb2N1bWVudCcpXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbG9nLmVycm9yKCdXYXJuOiBGb3JtYXQgRG9jdW1lbnQgbm90IGF2YWlsYWJsZSBmb3Igc2VsZWN0ZWQgbGFuZ3VhZ2UnKVxuICAgICAgICAgICAgaWYgKGF3YWl0IG1lbnUuZWxlbS5pc0Rpc3BsYXllZCgpKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgbWVudS5jbG9zZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBvcGVuQ29udGV4dE1lbnUgKCk6IFByb21pc2U8Q29udGV4dE1lbnU+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbGVtLmNsaWNrKHsgYnV0dG9uOiAyIH0pXG4gICAgICAgIGNvbnN0IHNoYWRvd1Jvb3RIb3N0ID0gYXdhaXQgdGhpcy52aWV3LmVsZW0uJCQoJy5zaGFkb3ctcm9vdC1ob3N0JylcblxuICAgICAgICBpZiAoc2hhZG93Um9vdEhvc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgc2hhZG93Um9vdCA9ICQoYXdhaXQgYnJvd3Nlci5leGVjdXRlKCdyZXR1cm4gYXJndW1lbnRzWzBdLnNoYWRvd1Jvb3QnLCBzaGFkb3dSb290SG9zdFswXSkpXG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbnRleHRNZW51KHRoaXMubG9jYXRvck1hcCwgc2hhZG93Um9vdCkud2FpdCgpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLm9wZW5Db250ZXh0TWVudSgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjdXJzb3IncyBjb29yZGluYXRlcyBhcyBhbiBhcnJheSBvZiB0d28gbnVtYmVyczogYFtsaW5lLCBjb2x1bW5dYFxuICAgICAqXG4gICAgICogKipDYXV0aW9uKiogbGluZSAmIGNvbHVtbiBjb29yZGluYXRlcyBkbyBub3Qgc3RhcnQgYXQgYDBgIGJ1dCBhdCBgMWAhXG4gICAgICovXG4gICAgYXN5bmMgZ2V0Q29vcmRpbmF0ZXMgKCk6IFByb21pc2U8W251bWJlciwgbnVtYmVyXT4ge1xuICAgICAgICBjb25zdCBjb29yZHM6IG51bWJlcltdID0gW11cbiAgICAgICAgY29uc3Qgc3RhdHVzQmFyID0gbmV3IFN0YXR1c0Jhcih0aGlzLmxvY2F0b3JNYXApXG4gICAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gPFJlZ0V4cE1hdGNoQXJyYXk+KGF3YWl0IHN0YXR1c0Jhci5nZXRDdXJyZW50UG9zaXRpb24oKSkubWF0Y2goL1xcZCsvZylcbiAgICAgICAgZm9yIChjb25zdCBjIG9mIGNvb3JkaW5hdGVzKSB7XG4gICAgICAgICAgICBjb29yZHMucHVzaCgrYylcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW2Nvb3Jkc1swXSwgY29vcmRzWzFdXVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSBicmVha3BvaW50IG9uIGEgZ2l2ZW4gbGluZVxuICAgICAqXG4gICAgICogQHBhcmFtIGxpbmUgdGFyZ2V0IGxpbmUgbnVtYmVyXG4gICAgICogQHJldHVybnMgcHJvbWlzZSByZXNvbHZpbmcgdG8gdHJ1ZSB3aGVuIGEgYnJlYWtwb2ludCB3YXMgYWRkZWQsIGZhbHNlIHdoZW4gcmVtb3ZlZCBvclxuICAgICAqL1xuICAgIGFzeW5jIHRvZ2dsZUJyZWFrcG9pbnQgKGxpbmU6IG51bWJlcik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBtYXJnaW4gPSBhd2FpdCB0aGlzLm1hcmdpbkFyZWEkXG4gICAgICAgIGNvbnN0IGxpbmVOdW0gPSBhd2FpdCBtYXJnaW4uJCh0aGlzLmxvY2F0b3JzLmxpbmVOdW1iZXIobGluZSkpXG4gICAgICAgIGF3YWl0IGxpbmVOdW0ubW92ZVRvKClcblxuICAgICAgICBjb25zdCBsaW5lT3ZlcmxheSA9IGF3YWl0IG1hcmdpbi4kKHRoaXMubG9jYXRvcnMubGluZU92ZXJsYXkobGluZSkpXG4gICAgICAgIGNvbnN0IGJyZWFrUG9pbnQgPSBhd2FpdCBsaW5lT3ZlcmxheS4kJCh0aGlzLmxvY2F0b3JzLmJyZWFrUG9pbnQpXG4gICAgICAgIGlmIChicmVha1BvaW50Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGF3YWl0IGJyZWFrUG9pbnRbMF0uY2xpY2soKVxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHdkaW8vbm8tcGF1c2VcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoMjAwKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub0JyZWFrID0gYXdhaXQgbGluZU92ZXJsYXkuJCQodGhpcy5sb2NhdG9ycy5kZWJ1Z0hpbnQpXG4gICAgICAgIGlmIChub0JyZWFrLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGF3YWl0IG5vQnJlYWtbMF0uY2xpY2soKVxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHdkaW8vbm8tcGF1c2VcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoMjAwKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIGNvZGUgbGVuc2VzIHdpdGhpbiB0aGUgZWRpdG9yXG4gICAgICogQHJldHVybnMgbGlzdCBvZiBDb2RlTGVucyBwYWdlIG9iamVjdHNcbiAgICAgKi9cbiAgICBhc3luYyBnZXRDb2RlTGVuc2VzICgpOiBQcm9taXNlPENvZGVMZW5zW10+IHtcbiAgICAgICAgY29uc3QgbGVuc2VzOiBDb2RlTGVuc1tdID0gW11cbiAgICAgICAgY29uc3Qgd2lkZ2V0cyA9IGF3YWl0IHRoaXMuZWxlbS4kKCcuY29udGVudFdpZGdldHMnKVxuICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHdpZGdldHMuJCQoJy4vL3NwYW5bY29udGFpbnMoQHdpZGdldGlkLCBcXCdjb2RlbGVucy53aWRnZXRcXCcpXScpXG5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hcmd1bWVudFxuICAgICAgICAgICAgbGVuc2VzLnB1c2goYXdhaXQgbmV3IENvZGVMZW5zKHRoaXMubG9jYXRvck1hcCwgaXRlbSBhcyBhbnksIHRoaXMpLndhaXQoKSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGVuc2VzXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgY29kZSBsZW5zIGJhc2VkIG9uIHRpdGxlLCBvciB6ZXJvIGJhc2VkIGluZGV4XG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhPclRpdGxlIHplcm8gYmFzZWQgaW5kZXggKGNvdW50aW5nIGZyb20gdGhlIHRvcCBvZiB0aGUgZWRpdG9yKSwgb3IgcGFydGlhbCB0aXRsZSBvZiB0aGUgY29kZSBsZW5zXG4gICAgICogQHJldHVybnMgQ29kZUxlbnMgb2JqZWN0IGlmIHN1Y2ggYSBjb2RlIGxlbnMgZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgZ2V0Q29kZUxlbnMgKGluZGV4T3JUaXRsZTogbnVtYmVyIHwgc3RyaW5nKTogUHJvbWlzZTxDb2RlTGVucyB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBjb25zdCBsZW5zZXMgPSBhd2FpdCB0aGlzLmdldENvZGVMZW5zZXMoKVxuXG4gICAgICAgIGlmICh0eXBlb2YgaW5kZXhPclRpdGxlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBsZW5zIG9mIGxlbnNlcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gYXdhaXQgbGVucy5nZXRUZXh0KClcbiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IHRpdGxlLm1hdGNoKGluZGV4T3JUaXRsZSlcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2ggJiYgbWF0Y2gubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGVuc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChsZW5zZXNbaW5kZXhPclRpdGxlXSkge1xuICAgICAgICAgICAgcmV0dXJuIGxlbnNlc1tpbmRleE9yVGl0bGVdXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cbn1cblxuaW50ZXJmYWNlIFNlbGVjdGlvbiBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBUZXh0RWRpdG9yTG9jYXRvcnM+IHt9XG4vKipcbiAqIFRleHQgc2VsZWN0aW9uIGJsb2NrXG4gKlxuICogQGNhdGVnb3J5IEVkaXRvclxuICovXG5AUGFnZURlY29yYXRvcihUZXh0RWRpdG9yTG9jYXRvcnMpXG5jbGFzcyBTZWxlY3Rpb24gZXh0ZW5kcyBFbGVtZW50V2l0aENvbnRleHRNZW51PHR5cGVvZiBUZXh0RWRpdG9yTG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ1RleHRFZGl0b3InIGFzIGNvbnN0XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBlbGVtZW50OiBDaGFpbmFibGVQcm9taXNlRWxlbWVudDxXZWJkcml2ZXJJTy5FbGVtZW50PixcbiAgICAgICAgcHVibGljIGVkaXRvcjogVGV4dEVkaXRvclxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycywgZWxlbWVudClcbiAgICB9XG5cbiAgICBhc3luYyBvcGVuQ29udGV4dE1lbnUgKCk6IFByb21pc2U8Q29udGV4dE1lbnU+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbGVtLmNsaWNrKHsgYnV0dG9uOiAyIH0pXG4gICAgICAgIGNvbnN0IHNoYWRvd1Jvb3RIb3N0ID0gYXdhaXQgdGhpcy5lZGl0b3Iudmlldy5lbGVtLiQkKCcuc2hhZG93LXJvb3QtaG9zdCcpXG5cbiAgICAgICAgaWYgKHNoYWRvd1Jvb3RIb3N0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHNoYWRvd1Jvb3QgPSAkKGF3YWl0IGJyb3dzZXIuZXhlY3V0ZSgncmV0dXJuIGFyZ3VtZW50c1swXS5zaGFkb3dSb290Jywgc2hhZG93Um9vdEhvc3RbMF0pKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb250ZXh0TWVudSh0aGlzLmxvY2F0b3JNYXAsIHNoYWRvd1Jvb3QpLndhaXQoKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdXBlci5vcGVuQ29udGV4dE1lbnUoKVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb2RlTGVucyBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBUZXh0RWRpdG9yTG9jYXRvcnM+IHt9XG4vKipcbiAqIFBhZ2Ugb2JqZWN0IGZvciBDb2RlIExlbnMgaW5zaWRlIGEgdGV4dCBlZGl0b3JcbiAqXG4gKiBAY2F0ZWdvcnkgRWRpdG9yXG4gKi9cbkBQYWdlRGVjb3JhdG9yKFRleHRFZGl0b3JMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBDb2RlTGVucyBleHRlbmRzIEJhc2VQYWdlPHR5cGVvZiBUZXh0RWRpdG9yTG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ1RleHRFZGl0b3InIGFzIGNvbnN0XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBlbGVtZW50OiBDaGFpbmFibGVQcm9taXNlRWxlbWVudDxXZWJkcml2ZXJJTy5FbGVtZW50PixcbiAgICAgICAgcHVibGljIGVkaXRvcjogVGV4dEVkaXRvclxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycywgZWxlbWVudClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRleHQgZGlzcGxheWVkIG9uIHRoZSBjb2RlIGxlbnNcbiAgICAgKiBAcmV0dXJucyB0ZXh0IGFzIHN0cmluZ1xuICAgICAqL1xuICAgIGFzeW5jIGdldFRleHQgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGxpbmsgPSBhd2FpdCB0aGlzLmVsZW0uJCgnYScpXG4gICAgICAgIHJldHVybiBsaW5rLmdldFRleHQoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0b29sdGlwIG9mIHRoZSBjb2RlIGxlbnNcbiAgICAgKiBAcmV0dXJucyB0b29sdGlwIGFzIHN0cmluZ1xuICAgICAqL1xuICAgIGFzeW5jIGdldFRvb2x0aXAgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGxpbmsgPSBhd2FpdCB0aGlzLmVsZW0uJCgnYScpXG4gICAgICAgIHJldHVybiBsaW5rLmdldEF0dHJpYnV0ZSgndGl0bGUnKVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBGaW5kV2lkZ2V0IGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIEZpbmRXaWRnZXRMb2NhdG9ycz4ge31cbi8qKlxuICogVGV4dCBFZGl0b3IncyBGaW5kIFdpZGdldFxuICpcbiAqIEBjYXRlZ29yeSBFZGl0b3JcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoRmluZFdpZGdldExvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIEZpbmRXaWRnZXQgZXh0ZW5kcyBCYXNlUGFnZTx0eXBlb2YgRmluZFdpZGdldExvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdGaW5kV2lkZ2V0JyBhcyBjb25zdFxuXG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBsb2NhdG9yczogVlNDb2RlTG9jYXRvck1hcCxcbiAgICAgICAgZWxlbWVudDogQ2hhaW5hYmxlUHJvbWlzZUVsZW1lbnQ8V2ViZHJpdmVySU8uRWxlbWVudD4sXG4gICAgICAgIHB1YmxpYyB0ZXh0RWRpdG9yOiBUZXh0RWRpdG9yXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzLCBlbGVtZW50KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSBiZXR3ZWVuIGZpbmQgYW5kIHJlcGxhY2UgbW9kZVxuICAgICAqIEBwYXJhbSByZXBsYWNlIHRydWUgZm9yIHJlcGxhY2UsIGZhbHNlIGZvciBmaW5kXG4gICAgICovXG4gICAgYXN5bmMgdG9nZ2xlUmVwbGFjZSAocmVwbGFjZTogYm9vbGVhbik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBidG4gPSBhd2FpdCB0aGlzLnRvZ2dsZVJlcGxhY2UkXG4gICAgICAgIGNvbnN0IGtsYXNzID0gYXdhaXQgYnRuLmdldEF0dHJpYnV0ZSgnY2xhc3MnKVxuXG4gICAgICAgIGlmICgocmVwbGFjZSAmJiBrbGFzcy5pbmNsdWRlcygnY29sbGFwc2VkJykpIHx8ICghcmVwbGFjZSAmJiAha2xhc3MuaW5jbHVkZXMoJ2NvbGxhcHNlZCcpKSkge1xuICAgICAgICAgICAgYXdhaXQgYnRuLmFkZFZhbHVlKCcgJylcbiAgICAgICAgICAgIGNvbnN0IHJlcGwgPSBhd2FpdCBicm93c2VyLiQodGhpcy5sb2NhdG9ycy5yZXBsYWNlUGFydClcbiAgICAgICAgICAgIGF3YWl0IHJlcGwud2FpdEZvckV4aXN0KHsgdGltZW91dDogMjAwMCB9KVxuICAgICAgICAgICAgaWYgKHJlcGxhY2UpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCByZXBsLndhaXRGb3JEaXNwbGF5ZWQoeyB0aW1lb3V0OiAyMDAwIH0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGF3YWl0IHJlcGwud2FpdEZvckRpc3BsYXllZCh7IHRpbWVvdXQ6IDIwMDAsIHJldmVyc2U6IHRydWUgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCB0ZXh0IGluIHRoZSBzZWFyY2ggYm94XG4gICAgICogQHBhcmFtIHRleHQgdGV4dCB0byBmaWxsIGluXG4gICAgICovXG4gICAgYXN5bmMgc2V0U2VhcmNoVGV4dCAodGV4dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IGJyb3dzZXIua2V5cyhbQ01EX0tFWSwgJ2YnXSlcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKHRleHQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRleHQgZnJvbSBGaW5kIGlucHV0IGJveFxuICAgICAqIEByZXR1cm5zIHZhbHVlIG9mIGZpbmQgaW5wdXQgYXMgc3RyaW5nXG4gICAgICovXG4gICAgYXN5bmMgZ2V0U2VhcmNoVGV4dCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgZmluZFBhcnQgPSBhd2FpdCB0aGlzLmZpbmRQYXJ0JFxuICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnB1dFRleHQoZmluZFBhcnQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHRleHQgaW4gdGhlIHJlcGxhY2UgYm94LiBXaWxsIHRvZ2dsZSByZXBsYWNlIG1vZGUgb24gaWYgY2FsbGVkIGluIGZpbmQgbW9kZS5cbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIGZpbGwgaW5cbiAgICAgKi9cbiAgICBhc3luYyBzZXRSZXBsYWNlVGV4dCAodGV4dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMudG9nZ2xlUmVwbGFjZSh0cnVlKVxuICAgICAgICBjb25zdCByZXBsYWNlUGFydCA9IGF3YWl0IHRoaXMucmVwbGFjZVBhcnQkXG4gICAgICAgIGF3YWl0IHRoaXMuc2V0VGV4dCh0ZXh0LCByZXBsYWNlUGFydClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGV4dCBmcm9tIFJlcGxhY2UgaW5wdXQgYm94XG4gICAgICogQHJldHVybnMgdmFsdWUgb2YgcmVwbGFjZSBpbnB1dCBhcyBzdHJpbmdcbiAgICAgKi9cbiAgICBhc3luYyBnZXRSZXBsYWNlVGV4dCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgcmVwbGFjZVBhcnQgPSBhd2FpdCB0aGlzLnJlcGxhY2VQYXJ0JFxuICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnB1dFRleHQocmVwbGFjZVBhcnQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xpY2sgJ05leHQgbWF0Y2gnXG4gICAgICovXG4gICAgYXN5bmMgbmV4dE1hdGNoICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9IGF3YWl0IGJyb3dzZXIuZ2V0VlNDb2RlVmVyc2lvbigpXG4gICAgICAgIGNvbnN0IG5hbWUgPSBzZW12ZXJMdCh2ZXJzaW9uLCAnMS41OS4wJykgPyAnTmV4dCBtYXRjaCcgOiAnTmV4dCBNYXRjaCdcbiAgICAgICAgYXdhaXQgdGhpcy5jbGlja0J1dHRvbihuYW1lLCAnZmluZCcpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xpY2sgJ1ByZXZpb3VzIG1hdGNoJ1xuICAgICAqL1xuICAgIGFzeW5jIHByZXZpb3VzTWF0Y2ggKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB2ZXJzaW9uID0gYXdhaXQgYnJvd3Nlci5nZXRWU0NvZGVWZXJzaW9uKClcbiAgICAgICAgY29uc3QgbmFtZSA9IHNlbXZlckx0KHZlcnNpb24sICcxLjU5LjAnKVxuICAgICAgICAgICAgPyAnUHJldmlvdXMgbWF0Y2gnXG4gICAgICAgICAgICA6ICdQcmV2aW91cyBNYXRjaCdcbiAgICAgICAgYXdhaXQgdGhpcy5jbGlja0J1dHRvbihuYW1lLCAnZmluZCcpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xpY2sgJ1JlcGxhY2UnLiBPbmx5IHdvcmtzIGluIHJlcGxhY2UgbW9kZS5cbiAgICAgKi9cbiAgICBhc3luYyByZXBsYWNlICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGlja0J1dHRvbignUmVwbGFjZScsICdyZXBsYWNlJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGljayAnUmVwbGFjZSBBbGwnLiBPbmx5IHdvcmtzIGluIHJlcGxhY2UgbW9kZS5cbiAgICAgKi9cbiAgICBhc3luYyByZXBsYWNlQWxsICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGlja0J1dHRvbignUmVwbGFjZSBBbGwnLCAncmVwbGFjZScpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgdGhlIHdpZGdldC5cbiAgICAgKi9cbiAgICBhc3luYyBjbG9zZSAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xpY2tCdXR0b24oJ0Nsb3NlJywgJ2ZpbmQnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbnVtYmVyIG9mIHJlc3VsdHMgYXMgYW4gb3JkZXJlZCBwYWlyIG9mIG51bWJlcnNcbiAgICAgKiBAcmV0dXJucyBwYWlyIGluIGZvcm0gb2YgW2N1cnJlbnQgcmVzdWx0IGluZGV4LCB0b3RhbCBudW1iZXIgb2YgcmVzdWx0c11cbiAgICAgKi9cbiAgICBhc3luYyBnZXRSZXN1bHRDb3VudCAoKTogUHJvbWlzZTxbbnVtYmVyLCBudW1iZXJdPiB7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdGhpcy5tYXRjaENvdW50JFxuICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgY291bnQuZ2V0VGV4dCgpXG5cbiAgICAgICAgaWYgKHRleHQuaW5jbHVkZXMoJ05vIHJlc3VsdHMnKSkge1xuICAgICAgICAgICAgcmV0dXJuIFswLCAwXVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG51bWJlcnMgPSB0ZXh0LnNwbGl0KCcgb2YgJylcbiAgICAgICAgcmV0dXJuIFsrbnVtYmVyc1swXSwgK251bWJlcnNbMV1dXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlIHRoZSBzZWFyY2ggdG8gbWF0Y2ggY2FzZVxuICAgICAqIEBwYXJhbSB0b2dnbGUgdHJ1ZSB0byB0dXJuIG9uLCBmYWxzZSB0byB0dXJuIG9mZlxuICAgICAqL1xuICAgIGFzeW5jIHRvZ2dsZU1hdGNoQ2FzZSAodG9nZ2xlOiBib29sZWFuKSB7XG4gICAgICAgIGF3YWl0IHRoaXMudG9nZ2xlQ29udHJvbCgnTWF0Y2ggQ2FzZScsICdmaW5kJywgdG9nZ2xlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSB0aGUgc2VhcmNoIHRvIG1hdGNoIHdob2xlIHdvcmRzXG4gICAgICogQHBhcmFtIHRvZ2dsZSB0cnVlIHRvIHR1cm4gb24sIGZhbHNlIHRvIHR1cm4gb2ZmXG4gICAgICovXG4gICAgYXN5bmMgdG9nZ2xlTWF0Y2hXaG9sZVdvcmQgKHRvZ2dsZTogYm9vbGVhbikge1xuICAgICAgICBhd2FpdCB0aGlzLnRvZ2dsZUNvbnRyb2woJ01hdGNoIFdob2xlIFdvcmQnLCAnZmluZCcsIHRvZ2dsZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUb2dnbGUgdGhlIHNlYXJjaCB0byB1c2UgcmVndWxhciBleHByZXNzaW9uc1xuICAgICAqIEBwYXJhbSB0b2dnbGUgdHJ1ZSB0byB0dXJuIG9uLCBmYWxzZSB0byB0dXJuIG9mZlxuICAgICAqL1xuICAgIGFzeW5jIHRvZ2dsZVVzZVJlZ3VsYXJFeHByZXNzaW9uICh0b2dnbGU6IGJvb2xlYW4pIHtcbiAgICAgICAgYXdhaXQgdGhpcy50b2dnbGVDb250cm9sKCdVc2UgUmVndWxhciBFeHByZXNzaW9uJywgJ2ZpbmQnLCB0b2dnbGUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlIHRoZSByZXBsYWNlIHRvIHByZXNlcnZlIGNhc2VcbiAgICAgKiBAcGFyYW0gdG9nZ2xlIHRydWUgdG8gdHVybiBvbiwgZmFsc2UgdG8gdHVybiBvZmZcbiAgICAgKi9cbiAgICBhc3luYyB0b2dnbGVQcmVzZXJ2ZUNhc2UgKHRvZ2dsZTogYm9vbGVhbikge1xuICAgICAgICBhd2FpdCB0aGlzLnRvZ2dsZUNvbnRyb2woJ1ByZXNlcnZlIENhc2UnLCAncmVwbGFjZScsIHRvZ2dsZSlcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHRvZ2dsZUNvbnRyb2wgKHRpdGxlOiBzdHJpbmcsIHBhcnQ6ICdmaW5kJyB8ICdyZXBsYWNlJywgdG9nZ2xlOiBib29sZWFuKSB7XG4gICAgICAgIGlmIChwYXJ0ICE9PSAnZmluZCcgJiYgcGFydCAhPT0gJ3JlcGxhY2UnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1wicGFydFwiIHBhcmFtZXRlciBuZWVkcyB0byBiZSBcImZpbmRcIiBvciBcInJlcGxhY2VcIicpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBlbGVtZW50ID0gcGFydCA9PT0gJ2ZpbmQnXG4gICAgICAgICAgICA/IGF3YWl0IHRoaXMuZmluZFBhcnQkXG4gICAgICAgICAgICA6IGF3YWl0IHRoaXMucmVwbGFjZVBhcnQkXG5cbiAgICAgICAgaWYgKHBhcnQgPT09ICdyZXBsYWNlJykge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy50b2dnbGVSZXBsYWNlKHRydWUpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb250cm9sID0gYXdhaXQgZWxlbWVudC4kKHRoaXMubG9jYXRvcnMuY2hlY2tib3godGl0bGUpKVxuICAgICAgICBjb25zdCBjaGVja2VkID0gYXdhaXQgY29udHJvbC5nZXRBdHRyaWJ1dGUoJ2FyaWEtY2hlY2tlZCcpXG4gICAgICAgIGlmICgodG9nZ2xlICYmIGNoZWNrZWQgIT09ICd0cnVlJykgfHwgKCF0b2dnbGUgJiYgY2hlY2tlZCA9PT0gJ3RydWUnKSkge1xuICAgICAgICAgICAgYXdhaXQgY29udHJvbC5jbGljaygpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGNsaWNrQnV0dG9uICh0aXRsZTogc3RyaW5nLCBwYXJ0OiAnZmluZCcgfCAncmVwbGFjZScpIHtcbiAgICAgICAgaWYgKHBhcnQgIT09ICdmaW5kJyAmJiBwYXJ0ICE9PSAncmVwbGFjZScpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignXCJwYXJ0XCIgcGFyYW1ldGVyIG5lZWRzIHRvIGJlIFwiZmluZFwiIG9yIFwicmVwbGFjZVwiJylcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBwYXJ0ID09PSAnZmluZCdcbiAgICAgICAgICAgID8gYXdhaXQgdGhpcy5maW5kUGFydCRcbiAgICAgICAgICAgIDogYXdhaXQgdGhpcy5yZXBsYWNlUGFydCRcblxuICAgICAgICBpZiAocGFydCA9PT0gJ3JlcGxhY2UnKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRvZ2dsZVJlcGxhY2UodHJ1ZSlcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJ0biA9IGF3YWl0IGVsZW1lbnQuJCh0aGlzLmxvY2F0b3JzLmJ1dHRvbih0aXRsZSkpXG4gICAgICAgIGF3YWl0IGJ0bi5jbGljaygpXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB3ZGlvL25vLXBhdXNlXG4gICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoMTAwKVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgc2V0VGV4dCAodGV4dDogc3RyaW5nLCBjb21wb3NpdGU6IFdlYmRyaXZlcklPLkVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBhd2FpdCBjb21wb3NpdGUuJCh0aGlzLmxvY2F0b3JzLmlucHV0KVxuICAgICAgICBhd2FpdCBpbnB1dC5zZXRWYWx1ZSh0ZXh0KVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgZ2V0SW5wdXRUZXh0IChjb21wb3NpdGU6IFdlYmRyaXZlcklPLkVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBhd2FpdCBjb21wb3NpdGUuJCh0aGlzLmxvY2F0b3JzLmNvbnRlbnQpXG4gICAgICAgIHJldHVybiBpbnB1dC5nZXRIVE1MKGZhbHNlKVxuICAgIH1cbn1cbiJdfQ==