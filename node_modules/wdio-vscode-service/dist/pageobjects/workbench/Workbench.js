var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { TitleBar } from '../menu/TitleBar.js';
import { SideBarView } from '../sidebar/SideBarView.js';
import { ActivityBar } from '../activityBar/ActivityBar.js';
import { StatusBar } from '../statusBar/StatusBar.js';
import { EditorView } from '../editor/EditorView.js';
import { BottomBarPanel } from '../bottomBar/BottomBarPanel.js';
import { StandaloneNotification } from './Notification.js';
import { QuickOpenBox, InputBox } from './Input.js';
import { SettingsEditor } from '../editor/SettingsEditor.js';
import { WebView } from './WebView.js';
import { PageDecorator, BasePage, sleep, semverGte } from '../utils.js';
import { Workbench as WorkbenchLocators } from '../../locators/1.73.0.js';
/**
 * Page object representing the custom VSCode title bar
 *
 * @category Workbench
 */
let Workbench = class Workbench extends BasePage {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = 'Workbench';
    }
    /**
     * Get a title bar handle
     */
    getTitleBar() {
        return new TitleBar(this.locatorMap);
    }
    /**
     * Get a side bar handle
     */
    getSideBar() {
        return new SideBarView(this.locatorMap);
    }
    /**
     * Get an activity bar handle
     */
    getActivityBar() {
        return new ActivityBar(this.locatorMap);
    }
    /**
     * Get a status bar handle
     */
    getStatusBar() {
        return new StatusBar(this.locatorMap);
    }
    /**
     * Get a bottom bar handle
     */
    getBottomBar() {
        return new BottomBarPanel(this.locatorMap);
    }
    /**
     * Get a handle for the editor view
     */
    getEditorView() {
        return new EditorView(this.locatorMap);
    }
    /**
     * Get all available webviews
     */
    getAllWebviews() {
        return WebView.getAllWebViews(this._locators);
    }
    /**
     * Get webview by title
     */
    async getWebviewByTitle(title) {
        const webviews = await this.getAllWebviews();
        if (webviews.length === 0) {
            throw new Error('No webviews found');
        }
        const foundTitles = [];
        const getTitle = () => document.title;
        for (const webview of webviews) {
            /**
             * jump into webview
             */
            await webview.open();
            /**
             * get the title of webview
             */
            const webviewTitle = await browser.execute(getTitle);
            foundTitles.push(webviewTitle);
            /**
             * jump out of webview
             */
            await webview.close();
            if (webviewTitle.match(title)) {
                return webview;
            }
        }
        throw new Error(`Couldn't find webview with title "${title}", `
            + `the following webview titles were found: "${foundTitles.join('", "')}"`);
    }
    /**
     * Get all standalone notifications (notifications outside the notifications center)
     * @returns Promise resolving to array of Notification objects
     */
    async getNotifications() {
        const notifications = [];
        const containers = await this.notificationContainer$$;
        if (containers.length === 0) {
            return [];
        }
        for (const container of containers) {
            const elements = await container.$$(this.locators.notificationItem);
            for (const element of elements) {
                notifications.push(await new StandaloneNotification(this.locatorMap, 
                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
                element).wait());
            }
        }
        return notifications;
    }
    /**
     * Verifies if any notifications are shown
     * @returns true if workbench has notifications, false otherwise
     */
    hasNotifications() {
        return this.notificationContainer$.isExisting();
    }
    /**
     * Opens the notifications center
     * @returns Promise resolving to NotificationsCenter object
     */
    openNotificationsCenter() {
        const statusBar = new StatusBar(this.locatorMap);
        return statusBar.openNotificationsCenter();
    }
    /**
     * Opens the settings editor
     *
     * @returns promise that resolves to a SettingsEditor instance
     */
    async openSettings() {
        await this.executeCommand('Preferences: Open User Settings');
        await new EditorView(this.locatorMap).openEditor('Settings');
        await this.elem.$(this.locatorMap.Editor.elem).waitForExist();
        await sleep(1500);
        return new SettingsEditor(this.locatorMap);
    }
    /**
     * Open the VS Code command line prompt
     * @returns Promise resolving to InputBox (vscode 1.44+) or QuickOpenBox (vscode up to 1.43) object
     */
    async openCommandPrompt() {
        const editorView = await new EditorView(this.locatorMap).wait();
        const webview = await editorView.webView$$;
        if (webview.length > 0) {
            const tab = await editorView.getActiveTab();
            if (tab) {
                await tab.elem.addValue('F1');
                const inputBox = new InputBox(this.locatorMap).wait();
                return inputBox;
            }
        }
        await browser.keys(['F1']);
        const version = await browser.getVSCodeVersion();
        if (((await browser.getVSCodeChannel()) === 'vscode'
            && semverGte(version, '1.44.0'))
            || version === 'insiders') {
            return new InputBox(this.locatorMap).wait();
        }
        return new QuickOpenBox(this.locatorMap).wait();
    }
    /**
     * Open the command prompt, type in a command, find the command using a fuzzy match, and execute
     * @param command text of the command to be executed
     * @returns Promise resolving to InputBox (vscode 1.44+) or QuickOpenBox (vscode up to 1.43) object
     * when the command prompt is confirmed
     */
    async executeCommand(command) {
        const prompt = await this.openCommandPrompt();
        await prompt.setText(`>${command}`);
        await prompt.confirm();
        return prompt;
    }
    /**
     * Open the command prompt, type in a command, find the command from the quick pick list, and execute
     * @param command text of the command to be executed
     * @returns Promise resolving to InputBox (vscode 1.44+) or QuickOpenBox (vscode up to 1.43) object
     * when the command prompt is confirmed
     */
    async executeQuickPick(command) {
        const prompt = await this.openCommandPrompt();
        await prompt.setText(`>${command}`);
        const quickPicks = await prompt.getQuickPicks();
        for (const quickPick of quickPicks) {
            const label = await quickPick.getLabel();
            if (label === command) {
                await quickPick.select();
                return prompt;
            }
        }
        throw new Error('Command not found');
    }
};
Workbench = __decorate([
    PageDecorator(WorkbenchLocators)
], Workbench);
export { Workbench };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV29ya2JlbmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3BhZ2VvYmplY3RzL3dvcmtiZW5jaC9Xb3JrYmVuY2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQzlDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sK0JBQStCLENBQUE7QUFDM0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDJCQUEyQixDQUFBO0FBQ3JELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQTtBQUNwRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZ0NBQWdDLENBQUE7QUFDL0QsT0FBTyxFQUFnQixzQkFBc0IsRUFBRSxNQUFNLG1CQUFtQixDQUFBO0FBRXhFLE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBQ25ELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUM1RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBRXRDLE9BQU8sRUFDSCxhQUFhLEVBQWtCLFFBQVEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUM1RCxNQUFNLGFBQWEsQ0FBQTtBQUNwQixPQUFPLEVBQUUsU0FBUyxJQUFJLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUE7QUFHekU7Ozs7R0FJRztBQUVJLElBQU0sU0FBUyxHQUFmLE1BQU0sU0FBVSxTQUFRLFFBQWtDO0lBQTFEOztRQUNIOztXQUVHO1FBQ0ksZUFBVSxHQUFHLFdBQW9CLENBQUE7SUFtTjVDLENBQUM7SUFqTkc7O09BRUc7SUFDSCxXQUFXO1FBQ1AsT0FBTyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDeEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsVUFBVTtRQUNOLE9BQU8sSUFBSSxXQUFXLENBQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQ2hELENBQUM7SUFFRDs7T0FFRztJQUNILGNBQWM7UUFDVixPQUFPLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUMzQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxZQUFZO1FBQ1IsT0FBTyxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDekMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsWUFBWTtRQUNSLE9BQU8sSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQzlDLENBQUM7SUFFRDs7T0FFRztJQUNILGFBQWE7UUFDVCxPQUFPLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxjQUFjO1FBQ1YsT0FBTyxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtJQUNqRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsaUJBQWlCLENBQUUsS0FBc0I7UUFDM0MsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUE7UUFFNUMsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQTtRQUN4QyxDQUFDO1FBRUQsTUFBTSxXQUFXLEdBQWEsRUFBRSxDQUFBO1FBQ2hDLE1BQU0sUUFBUSxHQUFHLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUE7UUFDckMsS0FBSyxNQUFNLE9BQU8sSUFBSSxRQUFRLEVBQUUsQ0FBQztZQUM3Qjs7ZUFFRztZQUNILE1BQU0sT0FBTyxDQUFDLElBQUksRUFBRSxDQUFBO1lBRXBCOztlQUVHO1lBQ0gsTUFBTSxZQUFZLEdBQUcsTUFBTSxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1lBQ3BELFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7WUFFOUI7O2VBRUc7WUFDSCxNQUFNLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQTtZQUVyQixJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDNUIsT0FBTyxPQUFPLENBQUE7WUFDbEIsQ0FBQztRQUNMLENBQUM7UUFFRCxNQUFNLElBQUksS0FBSyxDQUNYLHFDQUFxQyxLQUFLLEtBQUs7Y0FDN0MsNkNBQTZDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDN0UsQ0FBQTtJQUNMLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsZ0JBQWdCO1FBQ2xCLE1BQU0sYUFBYSxHQUFtQixFQUFFLENBQUE7UUFDeEMsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsdUJBQXVCLENBQUE7UUFFckQsSUFBSSxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQzFCLE9BQU8sRUFBRSxDQUFBO1FBQ2IsQ0FBQztRQUVELEtBQUssTUFBTSxTQUFTLElBQUksVUFBVSxFQUFFLENBQUM7WUFDakMsTUFBTSxRQUFRLEdBQUcsTUFBTSxTQUFTLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtZQUVuRSxLQUFLLE1BQU0sT0FBTyxJQUFJLFFBQVEsRUFBRSxDQUFDO2dCQUM3QixhQUFhLENBQUMsSUFBSSxDQUNkLE1BQU0sSUFBSSxzQkFBc0IsQ0FDNUIsSUFBSSxDQUFDLFVBQVU7Z0JBQ2YsaUVBQWlFO2dCQUNqRSxPQUFjLENBQ2pCLENBQUMsSUFBSSxFQUFFLENBQ1gsQ0FBQTtZQUNMLENBQUM7UUFDTCxDQUFDO1FBRUQsT0FBTyxhQUFhLENBQUE7SUFDeEIsQ0FBQztJQUVEOzs7T0FHRztJQUNILGdCQUFnQjtRQUNaLE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFDLFVBQVUsRUFBRSxDQUFBO0lBQ25ELENBQUM7SUFFRDs7O09BR0c7SUFDSCx1QkFBdUI7UUFDbkIsTUFBTSxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQ2hELE9BQU8sU0FBUyxDQUFDLHVCQUF1QixFQUFFLENBQUE7SUFDOUMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxLQUFLLENBQUMsWUFBWTtRQUNkLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFBO1FBQzVELE1BQU0sSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUM1RCxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQWMsQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFBO1FBQ3ZFLE1BQU0sS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ2pCLE9BQU8sSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQzlDLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsaUJBQWlCO1FBQ25CLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO1FBQy9ELE1BQU0sT0FBTyxHQUFHLE1BQU0sVUFBVSxDQUFDLFNBQVMsQ0FBQTtRQUMxQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDckIsTUFBTSxHQUFHLEdBQUcsTUFBTSxVQUFVLENBQUMsWUFBWSxFQUFFLENBQUE7WUFDM0MsSUFBSSxHQUFHLEVBQUUsQ0FBQztnQkFDTixNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFBO2dCQUM3QixNQUFNLFFBQVEsR0FBRyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7Z0JBQ3JELE9BQU8sUUFBUSxDQUFBO1lBQ25CLENBQUM7UUFDTCxDQUFDO1FBQ0QsTUFBTSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUMxQixNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO1FBQ2hELElBQ0ksQ0FBQyxDQUFDLE1BQU0sT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUMsS0FBSyxRQUFRO2VBQ3pDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7ZUFDakMsT0FBTyxLQUFLLFVBQVUsRUFDM0IsQ0FBQztZQUNDLE9BQU8sSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO1FBQy9DLENBQUM7UUFDRCxPQUFPLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUNuRCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxLQUFLLENBQUMsY0FBYyxDQUFFLE9BQWU7UUFDakMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQTtRQUM3QyxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQ25DLE1BQU0sTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBRXRCLE9BQU8sTUFBTSxDQUFBO0lBQ2pCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILEtBQUssQ0FBQyxnQkFBZ0IsQ0FBRSxPQUFlO1FBQ25DLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUE7UUFDN0MsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUNuQyxNQUFNLFVBQVUsR0FBRyxNQUFNLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQTtRQUMvQyxLQUFLLE1BQU0sU0FBUyxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQ2pDLE1BQU0sS0FBSyxHQUFHLE1BQU0sU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFBO1lBQ3hDLElBQUksS0FBSyxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUNwQixNQUFNLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtnQkFDeEIsT0FBTyxNQUFNLENBQUE7WUFDakIsQ0FBQztRQUNMLENBQUM7UUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUE7SUFDeEMsQ0FBQztDQUNKLENBQUE7QUF2TlksU0FBUztJQURyQixhQUFhLENBQUMsaUJBQWlCLENBQUM7R0FDcEIsU0FBUyxDQXVOckIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUaXRsZUJhciB9IGZyb20gJy4uL21lbnUvVGl0bGVCYXIuanMnXG5pbXBvcnQgeyBTaWRlQmFyVmlldyB9IGZyb20gJy4uL3NpZGViYXIvU2lkZUJhclZpZXcuanMnXG5pbXBvcnQgeyBBY3Rpdml0eUJhciB9IGZyb20gJy4uL2FjdGl2aXR5QmFyL0FjdGl2aXR5QmFyLmpzJ1xuaW1wb3J0IHsgU3RhdHVzQmFyIH0gZnJvbSAnLi4vc3RhdHVzQmFyL1N0YXR1c0Jhci5qcydcbmltcG9ydCB7IEVkaXRvclZpZXcgfSBmcm9tICcuLi9lZGl0b3IvRWRpdG9yVmlldy5qcydcbmltcG9ydCB7IEJvdHRvbUJhclBhbmVsIH0gZnJvbSAnLi4vYm90dG9tQmFyL0JvdHRvbUJhclBhbmVsLmpzJ1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uLCBTdGFuZGFsb25lTm90aWZpY2F0aW9uIH0gZnJvbSAnLi9Ob3RpZmljYXRpb24uanMnXG5pbXBvcnQgeyBOb3RpZmljYXRpb25zQ2VudGVyIH0gZnJvbSAnLi9Ob3RpZmljYXRpb25zQ2VudGVyLmpzJ1xuaW1wb3J0IHsgUXVpY2tPcGVuQm94LCBJbnB1dEJveCB9IGZyb20gJy4vSW5wdXQuanMnXG5pbXBvcnQgeyBTZXR0aW5nc0VkaXRvciB9IGZyb20gJy4uL2VkaXRvci9TZXR0aW5nc0VkaXRvci5qcydcbmltcG9ydCB7IFdlYlZpZXcgfSBmcm9tICcuL1dlYlZpZXcuanMnXG5cbmltcG9ydCB7XG4gICAgUGFnZURlY29yYXRvciwgSVBhZ2VEZWNvcmF0b3IsIEJhc2VQYWdlLCBzbGVlcCwgc2VtdmVyR3RlXG59IGZyb20gJy4uL3V0aWxzLmpzJ1xuaW1wb3J0IHsgV29ya2JlbmNoIGFzIFdvcmtiZW5jaExvY2F0b3JzIH0gZnJvbSAnLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtiZW5jaCBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBXb3JrYmVuY2hMb2NhdG9ycz4ge31cbi8qKlxuICogUGFnZSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBjdXN0b20gVlNDb2RlIHRpdGxlIGJhclxuICpcbiAqIEBjYXRlZ29yeSBXb3JrYmVuY2hcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoV29ya2JlbmNoTG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgV29ya2JlbmNoIGV4dGVuZHMgQmFzZVBhZ2U8dHlwZW9mIFdvcmtiZW5jaExvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdXb3JrYmVuY2gnIGFzIGNvbnN0XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYSB0aXRsZSBiYXIgaGFuZGxlXG4gICAgICovXG4gICAgZ2V0VGl0bGVCYXIgKCk6IFRpdGxlQmFyIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUaXRsZUJhcih0aGlzLmxvY2F0b3JNYXApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgc2lkZSBiYXIgaGFuZGxlXG4gICAgICovXG4gICAgZ2V0U2lkZUJhciAoKTogU2lkZUJhclZpZXc8YW55PiB7XG4gICAgICAgIHJldHVybiBuZXcgU2lkZUJhclZpZXc8YW55Pih0aGlzLmxvY2F0b3JNYXApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFuIGFjdGl2aXR5IGJhciBoYW5kbGVcbiAgICAgKi9cbiAgICBnZXRBY3Rpdml0eUJhciAoKTogQWN0aXZpdHlCYXIge1xuICAgICAgICByZXR1cm4gbmV3IEFjdGl2aXR5QmFyKHRoaXMubG9jYXRvck1hcClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYSBzdGF0dXMgYmFyIGhhbmRsZVxuICAgICAqL1xuICAgIGdldFN0YXR1c0JhciAoKTogU3RhdHVzQmFyIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNCYXIodGhpcy5sb2NhdG9yTWFwKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIGJvdHRvbSBiYXIgaGFuZGxlXG4gICAgICovXG4gICAgZ2V0Qm90dG9tQmFyICgpOiBCb3R0b21CYXJQYW5lbCB7XG4gICAgICAgIHJldHVybiBuZXcgQm90dG9tQmFyUGFuZWwodGhpcy5sb2NhdG9yTWFwKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIGhhbmRsZSBmb3IgdGhlIGVkaXRvciB2aWV3XG4gICAgICovXG4gICAgZ2V0RWRpdG9yVmlldyAoKTogRWRpdG9yVmlldyB7XG4gICAgICAgIHJldHVybiBuZXcgRWRpdG9yVmlldyh0aGlzLmxvY2F0b3JNYXApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFsbCBhdmFpbGFibGUgd2Vidmlld3NcbiAgICAgKi9cbiAgICBnZXRBbGxXZWJ2aWV3cyAoKSB7XG4gICAgICAgIHJldHVybiBXZWJWaWV3LmdldEFsbFdlYlZpZXdzKHRoaXMuX2xvY2F0b3JzKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB3ZWJ2aWV3IGJ5IHRpdGxlXG4gICAgICovXG4gICAgYXN5bmMgZ2V0V2Vidmlld0J5VGl0bGUgKHRpdGxlOiBzdHJpbmcgfCBSZWdFeHApIHtcbiAgICAgICAgY29uc3Qgd2Vidmlld3MgPSBhd2FpdCB0aGlzLmdldEFsbFdlYnZpZXdzKClcblxuICAgICAgICBpZiAod2Vidmlld3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHdlYnZpZXdzIGZvdW5kJylcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZvdW5kVGl0bGVzOiBzdHJpbmdbXSA9IFtdXG4gICAgICAgIGNvbnN0IGdldFRpdGxlID0gKCkgPT4gZG9jdW1lbnQudGl0bGVcbiAgICAgICAgZm9yIChjb25zdCB3ZWJ2aWV3IG9mIHdlYnZpZXdzKSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIGp1bXAgaW50byB3ZWJ2aWV3XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGF3YWl0IHdlYnZpZXcub3BlbigpXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogZ2V0IHRoZSB0aXRsZSBvZiB3ZWJ2aWV3XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGNvbnN0IHdlYnZpZXdUaXRsZSA9IGF3YWl0IGJyb3dzZXIuZXhlY3V0ZShnZXRUaXRsZSlcbiAgICAgICAgICAgIGZvdW5kVGl0bGVzLnB1c2god2Vidmlld1RpdGxlKVxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIGp1bXAgb3V0IG9mIHdlYnZpZXdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgYXdhaXQgd2Vidmlldy5jbG9zZSgpXG5cbiAgICAgICAgICAgIGlmICh3ZWJ2aWV3VGl0bGUubWF0Y2godGl0bGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdlYnZpZXdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBDb3VsZG4ndCBmaW5kIHdlYnZpZXcgd2l0aCB0aXRsZSBcIiR7dGl0bGV9XCIsIGBcbiAgICAgICAgICAgICsgYHRoZSBmb2xsb3dpbmcgd2VidmlldyB0aXRsZXMgd2VyZSBmb3VuZDogXCIke2ZvdW5kVGl0bGVzLmpvaW4oJ1wiLCBcIicpfVwiYFxuICAgICAgICApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFsbCBzdGFuZGFsb25lIG5vdGlmaWNhdGlvbnMgKG5vdGlmaWNhdGlvbnMgb3V0c2lkZSB0aGUgbm90aWZpY2F0aW9ucyBjZW50ZXIpXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYXJyYXkgb2YgTm90aWZpY2F0aW9uIG9iamVjdHNcbiAgICAgKi9cbiAgICBhc3luYyBnZXROb3RpZmljYXRpb25zICgpOiBQcm9taXNlPE5vdGlmaWNhdGlvbltdPiB7XG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbnM6IE5vdGlmaWNhdGlvbltdID0gW11cbiAgICAgICAgY29uc3QgY29udGFpbmVycyA9IGF3YWl0IHRoaXMubm90aWZpY2F0aW9uQ29udGFpbmVyJCRcblxuICAgICAgICBpZiAoY29udGFpbmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBjb250YWluZXIgb2YgY29udGFpbmVycykge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBhd2FpdCBjb250YWluZXIuJCQodGhpcy5sb2NhdG9ycy5ub3RpZmljYXRpb25JdGVtKVxuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zLnB1c2goXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBTdGFuZGFsb25lTm90aWZpY2F0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdG9yTWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgYXMgYW55XG4gICAgICAgICAgICAgICAgICAgICkud2FpdCgpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvbnNcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBWZXJpZmllcyBpZiBhbnkgbm90aWZpY2F0aW9ucyBhcmUgc2hvd25cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHdvcmtiZW5jaCBoYXMgbm90aWZpY2F0aW9ucywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgaGFzTm90aWZpY2F0aW9ucyAoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbkNvbnRhaW5lciQuaXNFeGlzdGluZygpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbnMgdGhlIG5vdGlmaWNhdGlvbnMgY2VudGVyXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gTm90aWZpY2F0aW9uc0NlbnRlciBvYmplY3RcbiAgICAgKi9cbiAgICBvcGVuTm90aWZpY2F0aW9uc0NlbnRlciAoKTogUHJvbWlzZTxOb3RpZmljYXRpb25zQ2VudGVyPiB7XG4gICAgICAgIGNvbnN0IHN0YXR1c0JhciA9IG5ldyBTdGF0dXNCYXIodGhpcy5sb2NhdG9yTWFwKVxuICAgICAgICByZXR1cm4gc3RhdHVzQmFyLm9wZW5Ob3RpZmljYXRpb25zQ2VudGVyKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVucyB0aGUgc2V0dGluZ3MgZWRpdG9yXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYSBTZXR0aW5nc0VkaXRvciBpbnN0YW5jZVxuICAgICAqL1xuICAgIGFzeW5jIG9wZW5TZXR0aW5ncyAoKTogUHJvbWlzZTxTZXR0aW5nc0VkaXRvcj4ge1xuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDb21tYW5kKCdQcmVmZXJlbmNlczogT3BlbiBVc2VyIFNldHRpbmdzJylcbiAgICAgICAgYXdhaXQgbmV3IEVkaXRvclZpZXcodGhpcy5sb2NhdG9yTWFwKS5vcGVuRWRpdG9yKCdTZXR0aW5ncycpXG4gICAgICAgIGF3YWl0IHRoaXMuZWxlbS4kKHRoaXMubG9jYXRvck1hcC5FZGl0b3IuZWxlbSBhcyBzdHJpbmcpLndhaXRGb3JFeGlzdCgpXG4gICAgICAgIGF3YWl0IHNsZWVwKDE1MDApXG4gICAgICAgIHJldHVybiBuZXcgU2V0dGluZ3NFZGl0b3IodGhpcy5sb2NhdG9yTWFwKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW4gdGhlIFZTIENvZGUgY29tbWFuZCBsaW5lIHByb21wdFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIElucHV0Qm94ICh2c2NvZGUgMS40NCspIG9yIFF1aWNrT3BlbkJveCAodnNjb2RlIHVwIHRvIDEuNDMpIG9iamVjdFxuICAgICAqL1xuICAgIGFzeW5jIG9wZW5Db21tYW5kUHJvbXB0ICgpOiBQcm9taXNlPFF1aWNrT3BlbkJveCB8IElucHV0Qm94PiB7XG4gICAgICAgIGNvbnN0IGVkaXRvclZpZXcgPSBhd2FpdCBuZXcgRWRpdG9yVmlldyh0aGlzLmxvY2F0b3JNYXApLndhaXQoKVxuICAgICAgICBjb25zdCB3ZWJ2aWV3ID0gYXdhaXQgZWRpdG9yVmlldy53ZWJWaWV3JCRcbiAgICAgICAgaWYgKHdlYnZpZXcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgdGFiID0gYXdhaXQgZWRpdG9yVmlldy5nZXRBY3RpdmVUYWIoKVxuICAgICAgICAgICAgaWYgKHRhYikge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRhYi5lbGVtLmFkZFZhbHVlKCdGMScpXG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXRCb3ggPSBuZXcgSW5wdXRCb3godGhpcy5sb2NhdG9yTWFwKS53YWl0KClcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXRCb3hcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBicm93c2VyLmtleXMoWydGMSddKVxuICAgICAgICBjb25zdCB2ZXJzaW9uID0gYXdhaXQgYnJvd3Nlci5nZXRWU0NvZGVWZXJzaW9uKClcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgKChhd2FpdCBicm93c2VyLmdldFZTQ29kZUNoYW5uZWwoKSkgPT09ICd2c2NvZGUnXG4gICAgICAgICAgICAgICAgJiYgc2VtdmVyR3RlKHZlcnNpb24sICcxLjQ0LjAnKSlcbiAgICAgICAgICAgIHx8IHZlcnNpb24gPT09ICdpbnNpZGVycydcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IElucHV0Qm94KHRoaXMubG9jYXRvck1hcCkud2FpdCgpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBRdWlja09wZW5Cb3godGhpcy5sb2NhdG9yTWFwKS53YWl0KClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoZSBjb21tYW5kIHByb21wdCwgdHlwZSBpbiBhIGNvbW1hbmQsIGZpbmQgdGhlIGNvbW1hbmQgdXNpbmcgYSBmdXp6eSBtYXRjaCwgYW5kIGV4ZWN1dGVcbiAgICAgKiBAcGFyYW0gY29tbWFuZCB0ZXh0IG9mIHRoZSBjb21tYW5kIHRvIGJlIGV4ZWN1dGVkXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gSW5wdXRCb3ggKHZzY29kZSAxLjQ0Kykgb3IgUXVpY2tPcGVuQm94ICh2c2NvZGUgdXAgdG8gMS40Mykgb2JqZWN0XG4gICAgICogd2hlbiB0aGUgY29tbWFuZCBwcm9tcHQgaXMgY29uZmlybWVkXG4gICAgICovXG4gICAgYXN5bmMgZXhlY3V0ZUNvbW1hbmQgKGNvbW1hbmQ6IHN0cmluZyk6IFByb21pc2U8SW5wdXRCb3ggfCBRdWlja09wZW5Cb3g+IHtcbiAgICAgICAgY29uc3QgcHJvbXB0ID0gYXdhaXQgdGhpcy5vcGVuQ29tbWFuZFByb21wdCgpXG4gICAgICAgIGF3YWl0IHByb21wdC5zZXRUZXh0KGA+JHtjb21tYW5kfWApXG4gICAgICAgIGF3YWl0IHByb21wdC5jb25maXJtKClcblxuICAgICAgICByZXR1cm4gcHJvbXB0XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbiB0aGUgY29tbWFuZCBwcm9tcHQsIHR5cGUgaW4gYSBjb21tYW5kLCBmaW5kIHRoZSBjb21tYW5kIGZyb20gdGhlIHF1aWNrIHBpY2sgbGlzdCwgYW5kIGV4ZWN1dGVcbiAgICAgKiBAcGFyYW0gY29tbWFuZCB0ZXh0IG9mIHRoZSBjb21tYW5kIHRvIGJlIGV4ZWN1dGVkXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gSW5wdXRCb3ggKHZzY29kZSAxLjQ0Kykgb3IgUXVpY2tPcGVuQm94ICh2c2NvZGUgdXAgdG8gMS40Mykgb2JqZWN0XG4gICAgICogd2hlbiB0aGUgY29tbWFuZCBwcm9tcHQgaXMgY29uZmlybWVkXG4gICAgICovXG4gICAgYXN5bmMgZXhlY3V0ZVF1aWNrUGljayAoY29tbWFuZDogc3RyaW5nKTogUHJvbWlzZTxJbnB1dEJveCB8IFF1aWNrT3BlbkJveD4ge1xuICAgICAgICBjb25zdCBwcm9tcHQgPSBhd2FpdCB0aGlzLm9wZW5Db21tYW5kUHJvbXB0KClcbiAgICAgICAgYXdhaXQgcHJvbXB0LnNldFRleHQoYD4ke2NvbW1hbmR9YClcbiAgICAgICAgY29uc3QgcXVpY2tQaWNrcyA9IGF3YWl0IHByb21wdC5nZXRRdWlja1BpY2tzKClcbiAgICAgICAgZm9yIChjb25zdCBxdWlja1BpY2sgb2YgcXVpY2tQaWNrcykge1xuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBhd2FpdCBxdWlja1BpY2suZ2V0TGFiZWwoKVxuICAgICAgICAgICAgaWYgKGxhYmVsID09PSBjb21tYW5kKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgcXVpY2tQaWNrLnNlbGVjdCgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21wdFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb21tYW5kIG5vdCBmb3VuZCcpXG4gICAgfVxufVxuIl19